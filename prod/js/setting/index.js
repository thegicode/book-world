"use strict";(()=>{var w=class{constructor(){this._bus=document.createElement("div")}add(t,e){this._bus.addEventListener(t,e)}remove(t,e){this._bus.removeEventListener(t,e)}dispatch(t,e={}){this._bus.dispatchEvent(new CustomEvent(t,{detail:e}))}},u=new w;var _=function(r,t,e,n){function o(s){return s instanceof e?s:new e(function(a){a(s)})}return new(e||(e=Promise))(function(s,a){function h(i){try{c(n.next(i))}catch(d){a(d)}}function l(i){try{c(n.throw(i))}catch(d){a(d)}}function c(i){i.done?s(i.value):o(i.value).then(h,l)}c((n=n.apply(r,t||[])).next())})},B=class{constructor(t={}){this.defaultOptions=Object.assign({method:"GET",headers:{"Content-Type":"application/json"}},t)}fetch(t,e){return _(this,void 0,void 0,function*(){let n=Object.assign(Object.assign(Object.assign({},this.defaultOptions),e),{timeout:5e3});try{let o=yield fetch(t,n);if(!o.ok)throw new Error(`Http error! status: ${o.status}, message: ${o.statusText}`);return yield o.json()}catch(o){throw console.error(`Error fetching data: ${o}`),new Error(`Error fetching data: ${o}`)}})}},p=new B;var O=r=>JSON.parse(JSON.stringify(r)),L={favoriteBooks:[],libraries:{},regions:{}},R="BookWorld",g=r=>{try{localStorage.setItem(R,JSON.stringify(r))}catch(t){console.error(t)}},f=()=>{try{let r=localStorage.getItem(R);return r==null?(g(L),L):O(JSON.parse(r))}catch(r){throw console.error(r),new Error("Failed to get state from localStrage.")}},m=f();var x=r=>{m.regions[r]={},g(m)},D=r=>{delete m.regions[r],g(m)},q=(r,t,e)=>{m.regions[r][t]=e,g(m)},T=(r,t)=>{delete m.regions[r][t],g(m)};var b=class extends HTMLElement{constructor(){super(),this.favoriteBooksSize=this.getFavoriteBooksSize()}connectedCallback(){this.render(),this.setSelectedMenu()}disconnectedCallback(){}getFavoriteBooksSize(){return f().favoriteBooks.length}render(){this.innerHTML=`
            <nav class="gnb">
                <a class="gnb-item" href="./search">\uCC45 \uAC80\uC0C9</a>
                <a class="gnb-item" href="./favorite">\uB098\uC758 \uCC45 (<span class="size">${this.favoriteBooksSize}</span>)</a>
                <a class="gnb-item" href="./library">\uB3C4\uC11C\uAD00 \uC870\uD68C</a>
                <a class="gnb-item" href="./setting">\uC124\uC815</a>
            </nav>`}setSelectedMenu(){let e=["/search","/favorite","/library","/setting"].indexOf(document.location.pathname);e>=0&&(this.querySelectorAll("a")[e].ariaSelected="true")}};var v=class extends HTMLElement{constructor(){super()}};var F=function(r,t,e,n){function o(s){return s instanceof e?s:new e(function(a){a(s)})}return new(e||(e=Promise))(function(s,a){function h(i){try{c(n.next(i))}catch(d){a(d)}}function l(i){try{c(n.throw(i))}catch(d){a(d)}}function c(i){i.done?s(i.value):o(i.value).then(h,l)}c((n=n.apply(r,t||[])).next())})},y=class extends HTMLElement{constructor(){super(),this.regionData=null}connectedCallback(){this.fetchRegion()}fetchRegion(){return F(this,void 0,void 0,function*(){let t="../../../assets/json/region.json";try{this.regionData=yield p.fetch(t),this.render(),u.dispatch("fetch-region-data",{regionData:this.regionData})}catch(e){throw console.error(e),new Error("Fail to get region data.")}})}render(){if(!this.regionData)throw new Error("regionData is null.");let t=document.querySelector("#tp-region").content.firstElementChild,e=this.querySelector(".regions"),n=this.regionData.region,o=new DocumentFragment,s=Object.keys(f().regions);for(let[a,h]of Object.entries(n)){if(!t)return;let l=t.cloneNode(!0),c=l.querySelector("input");c.value=h,s.includes(a)&&(c.checked=!0);let i=l.querySelector("span");i&&(i.textContent=a),o.appendChild(l)}e.appendChild(o),this.changeRegion()}changeRegion(){this.querySelectorAll("[name=region]").forEach(e=>{e.addEventListener("change",()=>{let n=e.nextElementSibling.textContent||"";e.checked?x(n):D(n),u.dispatch("set-favorite-regions",{})})})}};var E=class extends HTMLElement{constructor(){super(),this.regionData=null,this.region=""}connectedCallback(){u.add("fetch-region-data",this.setRegionData.bind(this)),u.add("set-favorite-regions",this.renderRegion.bind(this))}disconnectedCallback(){u.remove("fetch-region-data",this.setRegionData),u.remove("set-favorite-regions",this.renderRegion)}setRegionData(t){let e=t;this.regionData=e.detail.regionData,this.renderRegion()}renderRegion(){let t=Object.keys(f().regions);if(t.length<1)return;let e=new DocumentFragment,n=document.querySelector("#tp-favorite-region").content.firstElementChild,o=this.querySelector(".regions");o.innerHTML="",t.forEach(a=>{if(!n)return;let h=n.cloneNode(!0),l=h.querySelector("span");l&&(l.textContent=a),e.appendChild(h)}),o.appendChild(e);let s=o.querySelector("input");if(s){s.checked=!0;let a=s.nextElementSibling.textContent||"";this.renderDetailRegions(a),this.changeRegion()}}renderDetailRegions(t){let e=this.querySelector(".detailRegions");if(!this.regionData)return;let n=f().regions[t],o=n?Object.values(n):[],s=document.querySelector("#tp-detail-region").content.firstElementChild;e.innerHTML="";let a=new DocumentFragment,h=this.regionData.detailRegion[t];if(h){for(let[l,c]of Object.entries(h)){if(!s)return;let i=s.cloneNode(!0),d=i.querySelector("span");d&&(d.textContent=l);let C=i.querySelector("input");C&&(C.value=c,o.includes(c)?(C.checked=!0,a.insertBefore(i,a.firstChild)):a.appendChild(i))}e.appendChild(a),this.region=t,this.onChangeDetail()}}changeRegion(){let t=this.querySelectorAll("[name=favorite-region]");Array.from(t).forEach(e=>{let n=e;n.addEventListener("change",()=>{if(n.checked){let o=n.nextElementSibling.textContent||"";this.renderDetailRegions(o)}})})}onChangeDetail(){let t=this.region;f().regions[t]||x(t),document.querySelectorAll("[name=detailRegion]").forEach(n=>{let o=n;o.addEventListener("change",()=>{let{value:s}=o,a=o.nextElementSibling.textContent||"";o.checked?q(t,a,s):T(t,a),u.dispatch("set-detail-regions",{})})})}};var k=class extends HTMLElement{constructor(){super(),this.container=this.querySelector(".favorites")}connectedCallback(){this.render(),u.add("set-detail-regions",this.render.bind(this))}disconnectedCallback(){u.remove("set-detail-regions",this.render)}render(){this.container.innerHTML="";let{regions:t}=f();for(let e in t){let n=Object.keys(t[e]);if(n.length>0){let o=document.createElement("h3");o.textContent=e,this.container.appendChild(o),this.renderDetail(n)}}}renderDetail(t){let e=new DocumentFragment;t.forEach(n=>{let o=document.createElement("p");o.textContent=n,e.appendChild(o)}),this.container.appendChild(e)}};var H=function(r,t,e,n){function o(s){return s instanceof e?s:new e(function(a){a(s)})}return new(e||(e=Promise))(function(s,a){function h(i){try{c(n.next(i))}catch(d){a(d)}}function l(i){try{c(n.throw(i))}catch(d){a(d)}}function c(i){i.done?s(i.value):o(i.value).then(h,l)}c((n=n.apply(r,t||[])).next())})},S=class extends HTMLElement{constructor(){super(),this.storageButton=this.querySelector(".localStorage button"),this.resetButton=this.querySelector(".resetStorage button")}connectedCallback(){this.storageButton.addEventListener("click",this.setLocalStorageToBase.bind(this)),this.resetButton.addEventListener("click",this.resetStorage.bind(this))}disconnectedCallback(){this.storageButton.removeEventListener("click",this.setLocalStorageToBase),this.resetButton.removeEventListener("click",this.resetStorage)}setLocalStorageToBase(){return H(this,void 0,void 0,function*(){let t="../../../assets/json/storage-sample.json";try{let e=yield p.fetch(t);g(e),console.log("Saved local stronage by base data!"),location.reload()}catch(e){throw console.error(e),new Error("Fail to get storage sample data.")}})}resetStorage(){localStorage.removeItem("BookWorld"),location.reload()}};customElements.define("nav-gnb",b);customElements.define("app-setting",v);customElements.define("set-region",y);customElements.define("set-detail-region",E);customElements.define("favorite-regions",k);customElements.define("set-storage",S);})();
