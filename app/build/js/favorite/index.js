"use strict";(()=>{var m=class extends HTMLElement{constructor(){super(),this.el=null,this.button=null}set data(t){this.render(t)}connectedCallback(){this.render(this.data)}disconnectedCallback(){this.button&&this.button.removeEventListener("click",this.onButtonClick.bind(this))}render(t){let e=`
            <p class="description" data-ellipsis="true">${t}</p>
            <button type="button" class="more-description-button">\uC124\uBA85 \uB354\uBCF4\uAE30</button>`;this.innerHTML=e,this.el=this.querySelector(".description"),this.button=this.querySelector(".more-description-button"),this.button&&this.button.addEventListener("click",this.onButtonClick.bind(this))}onButtonClick(){if(this.el)switch(this.el.dataset.ellipsis){case"true":this.el.dataset.ellipsis="false",this.button&&(this.button.textContent="\uC124\uBA85 \uC811\uAE30");break;case"false":this.el.dataset.ellipsis="true",this.button&&(this.button.textContent="\uC124\uBA85 \uB354\uBCF4\uAE30");break}}};var E=class{constructor(){this._bus=document.createElement("div")}add(t,e){this._bus.addEventListener(t,e)}remove(t,e){this._bus.removeEventListener(t,e)}dispatch(t,e={}){this._bus.dispatchEvent(new CustomEvent(t,{detail:e}))}},H=new E;var M=function(n,t,e,o){function i(r){return r instanceof e?r:new e(function(a){a(r)})}return new(e||(e=Promise))(function(r,a){function h(s){try{c(o.next(s))}catch(l){a(l)}}function d(s){try{c(o.throw(s))}catch(l){a(l)}}function c(s){s.done?r(s.value):i(s.value).then(h,d)}c((o=o.apply(n,t||[])).next())})},S=class{constructor(t={}){this.defaultOptions=Object.assign({method:"GET",headers:{"Content-Type":"application/json"}},t)}fetch(t,e){return M(this,void 0,void 0,function*(){let o=Object.assign(Object.assign(Object.assign({},this.defaultOptions),e),{timeout:5e3});try{let i=yield fetch(t,o);if(!i.ok)throw new Error(`Http error! status: ${i.status}, message: ${i.statusText}`);return yield i.json()}catch(i){throw console.error(`Error fetching data: ${i}`),new Error(`Error fetching data: ${i}`)}})}},g=new S;var w=function(n,t,e,o){function i(r){return r instanceof e?r:new e(function(a){a(r)})}return new(e||(e=Promise))(function(r,a){function h(s){try{c(o.next(s))}catch(l){a(l)}}function d(s){try{c(o.throw(s))}catch(l){a(l)}}function c(s){s.done?r(s.value):i(s.value).then(h,d)}c((o=o.apply(n,t||[])).next())})},b=class extends HTMLElement{constructor(){super(),this.container=this.querySelector(".library-list"),this.itemTemplate=""}connectedCallback(){this.itemTemplate=this.template()}onLibraryBookExist(t,e,o){return w(this,void 0,void 0,function*(){let i=Object.entries(o);this.loading(i.length),t&&(t.disabled=!0);let r=i.map(([a,h],d)=>w(this,void 0,void 0,function*(){try{let c=yield g.fetch(`/book-exist?isbn13=${e}&libCode=${a}`);this.renderBookExist(c,h,d)}catch(c){throw console.error(c),new Error("Fail to get usage analysis list.")}}));try{yield Promise.all(r),this.removeLoading()}catch(a){console.error("Failed to fetch data for some libraries")}})}renderBookExist(t,e,o){let{hasBook:i,loanAvailable:r}=t,a=i==="Y"?"\uC18C\uC7A5, ":"\uBBF8\uC18C\uC7A5",h="";i==="Y"&&(h=r==="Y"?"\uB300\uCD9C\uAC00\uB2A5":"\uB300\uCD9C\uBD88\uAC00");let d=this.querySelectorAll(".library-item")[o],c=d.querySelector(".name");c&&(c.textContent=`\u263C ${e} : `);let s=d.querySelector(".hasBook");s&&(s.textContent=a);let l=d.querySelector(".loanAvailable");l&&(l.textContent=h)}loading(t){let e="";for(;t>0;)e+=this.itemTemplate,t--;this.container.innerHTML=e}removeLoading(){this.querySelectorAll(".library-item[data-loading=true]").forEach(e=>{delete e.dataset.loading})}template(){return`<li class="library-item" data-loading="true">
            <span class="name"></span>
            <span class="hasBook"></span>
            <span class="loanAvailable"></span>
        </li>`}};var A=n=>JSON.parse(JSON.stringify(n)),q={favoriteBooks:[],libraries:{},regions:{}},_="BookWorld",C=n=>{try{localStorage.setItem(_,JSON.stringify(n))}catch(t){console.error(t)}},f=()=>{try{let n=localStorage.getItem(_);return n==null?(C(q),q):A(JSON.parse(n))}catch(n){throw console.error(n),new Error("Failed to get state from localStrage.")}},u=f(),T=n=>{u.favoriteBooks.push(n),C(u)},F=n=>{let t=u.favoriteBooks.indexOf(n);t!==-1&&(u.favoriteBooks.splice(t,1),C(u))},$=n=>u.favoriteBooks.includes(n);var p=class extends HTMLElement{constructor(){super(),this.favoriteBooksSize=this.getFavoriteBooksSize()}connectedCallback(){this.render(),this.setSelectedMenu()}disconnectedCallback(){}getFavoriteBooksSize(){return f().favoriteBooks.length}render(){this.innerHTML=`
            <nav class="gnb">
                <a class="gnb-item" href="./search">\uCC45 \uAC80\uC0C9</a>
                <a class="gnb-item" href="./favorite">\uB098\uC758 \uCC45 (<span class="size">${this.favoriteBooksSize}</span>)</a>
                <a class="gnb-item" href="./library">\uB3C4\uC11C\uAD00 \uC870\uD68C</a>
                <a class="gnb-item" href="./setting">\uC124\uC815</a>
            </nav>`}setSelectedMenu(){let e=["/search","/favorite","/library","/setting"].indexOf(document.location.pathname);e>=0&&(this.querySelectorAll("a")[e].ariaSelected="true")}};var O=(n=f().favoriteBooks.length)=>{let t=document.querySelector("nav-gnb");t.querySelector(".size").textContent=String(n)};var v=class extends HTMLElement{constructor(){super(),this.inputElement=null,this.isbn=null}connectedCallback(){var t;let e=this.closest("[data-isbn]");this.isbn=e.dataset.isbn,this.render(),(t=this.inputElement)===null||t===void 0||t.addEventListener("change",this.onChange.bind(this))}disconnectedCallback(){var t;(t=this.inputElement)===null||t===void 0||t.addEventListener("change",this.onChange)}render(){let t=this.isbn||"",e=$(t)?"checked":"";this.innerHTML=`<label>
            <input type="checkbox" name="favorite" ${e}>
            <span>\uAD00\uC2EC\uCC45</span>
        </label>`,this.inputElement=this.querySelector("input")}onChange(){var t;let e=this.isbn||"";!((t=this.inputElement)===null||t===void 0)&&t.checked?T(e):F(e),O()}};var k=class extends HTMLElement{constructor(){super()}set data(t){this.dataset.object=JSON.stringify(t);let e=this.querySelector("img");e&&e.getAttribute("src")===""&&this.render()}connectedCallback(){this.render()}render(){let t=this.dataset.object?JSON.parse(this.dataset.object):null,e="",o="";if(t){let{bookImageURL:r,bookname:a}=t;e=r,o=a}this.innerHTML=`
            <div class="book-image">
                <img class="thumb" src="${e}" alt="${o}"></img>
            </div>`;let i=this.querySelector("img");i&&i.getAttribute("src")&&this.handleError(i)}handleError(t){t&&(t.onerror=()=>{this.dataset.fail="true",t.remove()})}};var y=class extends HTMLElement{constructor(){super(),this.$booksEl=this.querySelector(".favorite-books")}get favoriteBooks(){return f().favoriteBooks}connectedCallback(){if(this.favoriteBooks.length===0){this.renderMessage();return}this.render()}disconnectedCallback(){}render(){let t=new DocumentFragment,e=document.querySelector("#tp-favorite-item").content.firstElementChild;e&&this.favoriteBooks.forEach(o=>{if(typeof o!="string")return;let i=e.cloneNode(!0);i.dataset.isbn=o,t.appendChild(i)}),this.$booksEl.appendChild(t)}renderMessage(){let t=document.querySelector("#tp-message").content.firstElementChild;if(t){let e=t.cloneNode(!0);e.textContent="\uAD00\uC2EC\uCC45\uC744 \uB4F1\uB85D\uD574\uC8FC\uC138\uC694.",this.$booksEl.appendChild(e)}}};var I=function(n,t,e,o){function i(r){return r instanceof e?r:new e(function(a){a(r)})}return new(e||(e=Promise))(function(r,a){function h(s){try{c(o.next(s))}catch(l){a(l)}}function d(s){try{c(o.throw(s))}catch(l){a(l)}}function c(s){s.done?r(s.value):i(s.value).then(h,d)}c((o=o.apply(n,t||[])).next())})},x=class extends HTMLElement{constructor(){super(),this.libraryButton=this.querySelector(".library-button"),this.anchorElement=this.querySelector("a")}connectedCallback(){this.loading(),this.fetchData(this.dataset.isbn),this.libraryButton.addEventListener("click",this.onLibrary.bind(this)),this.anchorElement.addEventListener("click",this.onClick.bind(this))}disconnectedCallback(){this.libraryButton.removeEventListener("click",this.onLibrary),this.anchorElement.removeEventListener("click",this.onClick)}fetchData(t){return I(this,void 0,void 0,function*(){let e=`/usage-analysis-list?isbn13=${t}`;try{let o=yield g.fetch(e);this.render(o)}catch(o){throw this.errorRender(),console.error(o),new Error("Fail to get usage analysis list.")}})}render(t){let{book:e}=t,{authors:o,bookImageURL:i,bookname:r,class_nm:a,description:h,isbn13:d,loanCnt:c,publication_year:s,publisher:l}=e;this.bookData=t,this.querySelector(".bookname").textContent=r,this.querySelector(".authors").textContent=o,this.querySelector(".class_nm").textContent=a,this.querySelector(".isbn13").textContent=d,this.querySelector(".loanCnt").textContent=c.toLocaleString(),this.querySelector(".publication_year").textContent=s,this.querySelector(".publisher").textContent=l;let B=this.querySelector("book-description");B&&(B.data=h);let L=this.querySelector("book-image");L&&(L.data={bookImageURL:i,bookname:r}),this.removeLoading()}errorRender(){this.removeLoading(),this.dataset.fail="true",this.querySelector("h4").textContent=`${this.dataset.isbn}\uC758 \uCC45 \uC815\uBCF4\uB97C \uAC00\uC838\uC62C \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.`}onLibrary(){let t=this.dataset.isbn||"",e=this.querySelector("library-book-exist");e&&e.onLibraryBookExist(this.libraryButton,t,u.libraries)}loading(){this.dataset.loading="true"}removeLoading(){delete this.dataset.loading}onClick(t){t.preventDefault(),location.href=`book?isbn=${this.dataset.isbn}`}};customElements.define("nav-gnb",p);customElements.define("app-favorite",y);customElements.define("favorite-item",x);customElements.define("book-description",m);customElements.define("library-book-exist",b);customElements.define("checkbox-favorite-book",v);customElements.define("book-image",k);})();
