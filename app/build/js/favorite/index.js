"use strict";(()=>{var de=Object.defineProperty,ce=Object.defineProperties;var ue=Object.getOwnPropertyDescriptors;var z=Object.getOwnPropertySymbols;var ne=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable;var se=(a,t,e)=>t in a?de(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e,T=(a,t)=>{for(var e in t||(t={}))ne.call(t,e)&&se(a,e,t[e]);if(z)for(var e of z(t))oe.call(t,e)&&se(a,e,t[e]);return a},W=(a,t)=>ce(a,ue(t));var ae=(a,t)=>{var e={};for(var r in a)ne.call(a,r)&&t.indexOf(r)<0&&(e[r]=a[r]);if(a!=null&&z)for(var r of z(a))t.indexOf(r)<0&&oe.call(a,r)&&(e[r]=a[r]);return e};var L=(a,t,e)=>new Promise((r,s)=>{var h=p=>{try{b(e.next(p))}catch(y){s(y)}},c=p=>{try{b(e.throw(p))}catch(y){s(y)}},b=p=>p.done?r(p.value):Promise.resolve(p.value).then(h,c);b((e=e.apply(a,t)).next())});var _=class extends HTMLElement{constructor(){super();this.el=null,this.button=null}set data(e){this.render(e)}connectedCallback(){this.render(this.data)}disconnectedCallback(){this.button&&this.button.removeEventListener("click",this.onButtonClick.bind(this))}render(e){let r=`
            <p class="description" data-ellipsis="true">${e}</p>
            <button type="button" class="more-description-button">\uC124\uBA85 \uB354\uBCF4\uAE30</button>`;this.innerHTML=r,this.el=this.querySelector(".description"),this.button=this.querySelector(".more-description-button"),this.button&&this.button.addEventListener("click",this.onButtonClick.bind(this))}onButtonClick(){if(this.el)switch(this.el.dataset.ellipsis){case"true":this.el.dataset.ellipsis="false",this.button&&(this.button.textContent="\uC124\uBA85 \uC811\uAE30");break;case"false":this.el.dataset.ellipsis="true",this.button&&(this.button.textContent="\uC124\uBA85 \uB354\uBCF4\uAE30");break}}};var C=class extends HTMLElement{constructor(e,r){super();this.image=null;this.render(e,r)}render(e,r){let s=document.createElement("img");s.className="thumb",s.src=e,s.alt=r,s.onerror=this.onError.bind(this),this.image=s,this.appendChild(s)}onError(){var e;this.dataset.fail="true",console.error("Failed to load image"),(e=this.image)==null||e.remove()}};var G="BookWorld";var f=class{constructor(){this.subscribers=[]}subscribe(t){this.subscribers.push(t)}unsubscribe(t){this.subscribers=this.subscribers.filter(e=>e!==t)}notify(t){this.subscribers.forEach(e=>e(t))}};var F=class{constructor(t,e){this.categoriesUpdatePublisher=new f;this.bookUpdatePublisher=new f;this._favorites=t||{},this._sortedKeys=e||[]}get favorites(){return T({},this._favorites)}set favorites(t){this._favorites=t}get sortedKeys(){return[...this._sortedKeys]}set sortedKeys(t){this._sortedKeys=t}add(t){this._favorites[t]=[],this.categoriesUpdatePublisher.notify({type:"add",payload:{name:t}})}addSortedKeys(t){this._sortedKeys.push(t)}rename(t,e){t in this._favorites&&(this._favorites[e]=this._favorites[t],delete this._favorites[t],this.categoriesUpdatePublisher.notify({type:"rename",payload:{prevName:t,newName:e}}))}renameSortedKeys(t,e){let r=this._sortedKeys.indexOf(t);r!==-1&&(this._sortedKeys[r]=e)}change(t,e){let r=this._sortedKeys.indexOf(t),s=this._sortedKeys.indexOf(e);this._sortedKeys[s]=t,this._sortedKeys[r]=e,this.categoriesUpdatePublisher.notify({type:"change",payload:{targetIndex:s,draggedIndex:r}})}delete(t){delete this._favorites[t],this.categoriesUpdatePublisher.notify({type:"delete",payload:{name:t}})}deleteSortedKeys(t){let e=this._sortedKeys.indexOf(t);return this._sortedKeys.splice(e,1),e}has(t){return t in this._favorites}addBook(t,e){t in this._favorites&&this._favorites[t].unshift(e),this.bookUpdatePublisher.notify()}hasBook(t,e){return t in this._favorites&&this._favorites[t].includes(e)}removeBook(t,e){if(t in this._favorites){let r=this._favorites[t].indexOf(e);r!=-1&&this._favorites[t].splice(r,1)}this.bookUpdatePublisher.notify()}subscribeCategoriesUpdate(t){this.categoriesUpdatePublisher.subscribe(t)}unsubscribeCategoriesUpdate(t){this.categoriesUpdatePublisher.unsubscribe(t)}subscribeBookUpdate(t){this.bookUpdatePublisher.subscribe(t)}unsubscribeBookUpdate(t){this.bookUpdatePublisher.unsubscribe(t)}};var R=class{constructor(t){this.publisher=new f;this._libraries=t}get libraries(){return T({},this._libraries)}set libraries(t){this._libraries=t}add(t,e){this._libraries[t]=e,this.publisher.notify({type:"add",payload:{code:t,name:e}})}remove(t){delete this._libraries[t],this.publisher.notify({type:"delete",payload:{code:t}})}has(t){return t in this._libraries}subscribeUpdate(t){this.publisher.subscribe(t)}unsubscribeUpdate(t){this.publisher.subscribe(t)}};var O=class{constructor(t){this.updatePublisher=new f;this.detailUpdatePublisher=new f;this._regions=t}get regions(){return T({},this._regions)}set regions(t){this._regions=t}add(t){this._regions[t]={},this.updatePublisher.notify()}remove(t){delete this._regions[t],this.updatePublisher.notify()}addDetail(t,e,r){t in this._regions&&(this._regions[t][e]=r),this.detailUpdatePublisher.notify()}removeDetail(t,e){t in this._regions&&e in this._regions[t]&&delete this._regions[t][e],this.detailUpdatePublisher.notify()}subscribeUpdatePublisher(t){this.updatePublisher.subscribe(t)}unsubscribeUpdatePublisher(t){this.updatePublisher.unsubscribe(t)}subscribeDetailUpdatePublisher(t){this.detailUpdatePublisher.subscribe(t)}unsubscribeDetailUpdatePublisher(t){this.detailUpdatePublisher.unsubscribe(t)}};var be=a=>JSON.parse(JSON.stringify(a)),le={favorites:{},sortedFavoriteKeys:[],libraries:{},regions:{}},J=class{constructor(){this.bookStateUpdatePublisher=new f;let t=this.loadStorage()||be(le),{favorites:e,sortedFavoriteKeys:r,libraries:s,regions:h}=t;this.favoriteModel=new F(e,r),this.libraryModel=new R(s),this.regionModel=new O(h)}loadStorage(){let t=localStorage.getItem(G);return t?JSON.parse(t):null}setStorage(t){try{localStorage.setItem(G,JSON.stringify(t))}catch(e){console.error(e)}}get state(){return this.loadStorage()}set state(t){this.setStorage(t);let{favorites:e,sortedFavoriteKeys:r,libraries:s,regions:h}=t;this.favoriteModel.favorites=e,this.favoriteModel.sortedKeys=r,this.libraryModel.libraries=s,this.regionModel.regions=h,this.bookStateUpdatePublisher.notify(),console.log("set state")}get favorites(){return this.favoriteModel.favorites}get sortedFavoriteKeys(){return this.favoriteModel.sortedKeys}get libraries(){return this.libraryModel.libraries}get regions(){return this.regionModel.regions}resetState(){this.state=le}setFavorites(){let t=this.state;t.favorites=this.favorites,t.sortedFavoriteKeys=this.sortedFavoriteKeys,this.setStorage(t)}addfavorite(t){this.favoriteModel.add(t),this.favoriteModel.addSortedKeys(t),this.setFavorites()}renameFavorite(t,e){this.favoriteModel.rename(t,e),this.setFavorites()}renameSortedFavoriteKey(t,e){this.favoriteModel.renameSortedKeys(t,e),this.setFavorites()}deleteFavorite(t){this.favoriteModel.delete(t),this.setFavorites()}deleteSortedFavoriteKey(t){let e=this.favoriteModel.deleteSortedKeys(t);return this.setFavorites(),e}hasFavorite(t){return this.favoriteModel.has(t)}changeFavorite(t,e){this.favoriteModel.change(t,e),this.setFavorites()}addFavoriteBook(t,e){this.favoriteModel.addBook(t,e),this.setFavorites()}hasFavoriteBook(t,e){return this.favoriteModel.hasBook(t,e)}removeFavoriteBook(t,e){this.favoriteModel.removeBook(t,e),this.setFavorites()}setLibraries(){let t=this.state;t.libraries=this.libraries,this.setStorage(t)}addLibraries(t,e){this.libraryModel.add(t,e),this.setLibraries()}removeLibraries(t){this.libraryModel.remove(t),this.setLibraries()}hasLibrary(t){return this.libraryModel.has(t)}setRegions(){let t=this.state;t.regions=this.regions,this.setStorage(t)}addRegion(t){this.regionModel.add(t),this.setRegions()}removeRegion(t){this.regionModel.remove(t),this.setRegions()}addDetailRegion(t,e,r){this.regionModel.addDetail(t,e,r),this.setRegions()}removeDetailRegion(t,e){this.regionModel.removeDetail(t,e),this.setRegions()}subscribeToBookStateUpdate(t){this.bookStateUpdatePublisher.subscribe(t)}unsubscribeToBookStateUpdate(t){this.bookStateUpdatePublisher.unsubscribe(t)}subscribeFavoriteCategoriesUpdate(t){this.favoriteModel.subscribeCategoriesUpdate(t)}unsubscribeFavoriteCategoriesUpdate(t){this.favoriteModel.unsubscribeCategoriesUpdate(t)}subscribeFavoriteBookUpdate(t){this.favoriteModel.subscribeBookUpdate(t)}unsubscribeFavoriteBookUpdate(t){this.favoriteModel.unsubscribeBookUpdate(t)}subscribeLibraryUpdate(t){this.libraryModel.subscribeUpdate(t)}unsubscribeLibraryUpdate(t){this.libraryModel.unsubscribeUpdate(t)}subscribeRegionUpdate(t){this.regionModel.subscribeUpdatePublisher(t)}unsubscribeRegionUpdate(t){this.regionModel.unsubscribeUpdatePublisher(t)}subscribeDetailRegionUpdate(t){this.regionModel.subscribeDetailUpdatePublisher(t)}unsubscribeDetailRegionUpdate(t){this.regionModel.unsubscribeDetailUpdatePublisher(t)}},pe=new J,u=pe;var B=class extends HTMLElement{constructor(){super();this.createCategoryItem=e=>{if(!this.container)return;let r=document.createElement("label"),s=this.createCheckbox(e),h=document.createElement("span");return h.textContent=e,r.appendChild(s),r.appendChild(h),r};this.isbn=this.getISBN(),this.button=null,this.container=null,this.onClickCategory=this.onClickCategory.bind(this),this.handleCategoryUpdate=this.handleCategoryUpdate.bind(this)}connectedCallback(){var e;this.button=this.createButton(),this.container=this.createContainer(),this.render(),(e=this.button)==null||e.addEventListener("click",this.onClickCategory),u.subscribeFavoriteCategoriesUpdate(this.handleCategoryUpdate)}render(){!this.container||!this.button||(u.sortedFavoriteKeys.map(e=>this.createCategoryItem(e)).forEach(e=>{var r;return(r=this.container)==null?void 0:r.appendChild(e)}),this.appendChild(this.container),this.appendChild(this.button))}createButton(){let e=document.createElement("button");return e.className="category-button",e.textContent="Category",e}createContainer(){let e=document.createElement("div");return e.className="category",e.hidden=!0,e}onClickCategory(){let e=this.querySelector(".category");e.hidden=!e.hidden}getISBN(){let e=this.closest("[data-isbn]");return e&&e.dataset.isbn?e.dataset.isbn:null}createCheckbox(e){let r=this.isbn||"",s=document.createElement("input");return s.type="checkbox",u.hasFavoriteBook(e,r)&&(s.checked=!0),s.addEventListener("change",()=>this.onChange(s,e)),s}onChange(e,r){let s=this.isbn||"",h=u.hasFavoriteBook(r,s);h?u.removeFavoriteBook(r,s):u.addFavoriteBook(r,s),e.checked=!h}handleCategoryUpdate({type:e,payload:r}){let s={add:()=>this.handleAdd(r.name),rename:()=>this.reanmeCategory(r.newName),change:()=>this.changeCategory(r.targetIndex,r.draggedIndex),delete:()=>this.handleDelete(r.name)};s[e]?s[e]():console.error("no type")}handleAdd(e){var r;(r=this.container)==null||r.appendChild(this.createCategoryItem(e))}handleDelete(e){this.querySelectorAll("label span").forEach((r,s)=>{r.textContent===e&&this.querySelectorAll("label")[s].remove()})}changeCategory(e,r){var b,p;let s=this.querySelectorAll("label"),h=this.createCategoryItem((b=s[r].querySelector("span"))==null?void 0:b.textContent),c=this.createCategoryItem((p=s[e].querySelector("span"))==null?void 0:p.textContent);s[e].replaceWith(h),s[r].replaceWith(c)}reanmeCategory(e){let r=this.querySelectorAll("label")[u.sortedFavoriteKeys.indexOf(e)],s=this.createCategoryItem(e);r.replaceWith(s)}};var Q=class{constructor(){this._bus=document.createElement("div")}add(t,e){this._bus.addEventListener(t,e)}remove(t,e){this._bus.removeEventListener(t,e)}dispatch(t,e={}){this._bus.dispatchEvent(new CustomEvent(t,{detail:e}))}},me=new Q;var X=class{constructor(t={}){this.defaultOptions=T({method:"GET",headers:{"Content-Type":"application/json"}},t)}fetch(t,e){return L(this,null,function*(){let r=W(T(T({},this.defaultOptions),e),{timeout:5e3});try{let s=yield fetch(t,r);if(!s.ok)throw new Error(`Http error! status: ${s.status}, message: ${s.statusText}`);return yield s.json()}catch(s){throw console.error(`Error fetching data: ${s}`),new Error(`Error fetching data: ${s}`)}})}},M=new X;(function(){"use strict";if(typeof window!="object")return;if("IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype){"isIntersecting"in window.IntersectionObserverEntry.prototype||Object.defineProperty(window.IntersectionObserverEntry.prototype,"isIntersecting",{get:function(){return this.intersectionRatio>0}});return}function a(i){try{return i.defaultView&&i.defaultView.frameElement||null}catch(n){return null}}var t=function(i){for(var n=i,o=a(n);o;)n=o.ownerDocument,o=a(n);return n}(window.document),e=[],r=null,s=null;function h(i){this.time=i.time,this.target=i.target,this.rootBounds=Y(i.rootBounds),this.boundingClientRect=Y(i.boundingClientRect),this.intersectionRect=Y(i.intersectionRect||U()),this.isIntersecting=!!i.intersectionRect;var n=this.boundingClientRect,o=n.width*n.height,l=this.intersectionRect,d=l.width*l.height;o?this.intersectionRatio=Number((d/o).toFixed(4)):this.intersectionRatio=this.isIntersecting?1:0}function c(i,n){var o=n||{};if(typeof i!="function")throw new Error("callback must be a function");if(o.root&&o.root.nodeType!=1&&o.root.nodeType!=9)throw new Error("root must be a Document or Element");this._checkForIntersections=p(this._checkForIntersections.bind(this),this.THROTTLE_TIMEOUT),this._callback=i,this._observationTargets=[],this._queuedEntries=[],this._rootMarginValues=this._parseRootMargin(o.rootMargin),this.thresholds=this._initThresholds(o.threshold),this.root=o.root||null,this.rootMargin=this._rootMarginValues.map(function(l){return l.value+l.unit}).join(" "),this._monitoringDocuments=[],this._monitoringUnsubscribes=[]}c.prototype.THROTTLE_TIMEOUT=100,c.prototype.POLL_INTERVAL=null,c.prototype.USE_MUTATION_OBSERVER=!0,c._setupCrossOriginUpdater=function(){return r||(r=function(i,n){!i||!n?s=U():s=Z(i,n),e.forEach(function(o){o._checkForIntersections()})}),r},c._resetCrossOriginUpdater=function(){r=null,s=null},c.prototype.observe=function(i){var n=this._observationTargets.some(function(o){return o.element==i});if(!n){if(!(i&&i.nodeType==1))throw new Error("target must be an Element");this._registerInstance(),this._observationTargets.push({element:i,entry:null}),this._monitorIntersections(i.ownerDocument),this._checkForIntersections()}},c.prototype.unobserve=function(i){this._observationTargets=this._observationTargets.filter(function(n){return n.element!=i}),this._unmonitorIntersections(i.ownerDocument),this._observationTargets.length==0&&this._unregisterInstance()},c.prototype.disconnect=function(){this._observationTargets=[],this._unmonitorAllIntersections(),this._unregisterInstance()},c.prototype.takeRecords=function(){var i=this._queuedEntries.slice();return this._queuedEntries=[],i},c.prototype._initThresholds=function(i){var n=i||[0];return Array.isArray(n)||(n=[n]),n.sort().filter(function(o,l,d){if(typeof o!="number"||isNaN(o)||o<0||o>1)throw new Error("threshold must be a number between 0 and 1 inclusively");return o!==d[l-1]})},c.prototype._parseRootMargin=function(i){var n=i||"0px",o=n.split(/\s+/).map(function(l){var d=/^(-?\d*\.?\d+)(px|%)$/.exec(l);if(!d)throw new Error("rootMargin must be specified in pixels or percent");return{value:parseFloat(d[1]),unit:d[2]}});return o[1]=o[1]||o[0],o[2]=o[2]||o[0],o[3]=o[3]||o[1],o},c.prototype._monitorIntersections=function(i){var n=i.defaultView;if(n&&this._monitoringDocuments.indexOf(i)==-1){var o=this._checkForIntersections,l=null,d=null;this.POLL_INTERVAL?l=n.setInterval(o,this.POLL_INTERVAL):(y(n,"resize",o,!0),y(i,"scroll",o,!0),this.USE_MUTATION_OBSERVER&&"MutationObserver"in n&&(d=new n.MutationObserver(o),d.observe(i,{attributes:!0,childList:!0,characterData:!0,subtree:!0}))),this._monitoringDocuments.push(i),this._monitoringUnsubscribes.push(function(){var v=i.defaultView;v&&(l&&v.clearInterval(l),$(v,"resize",o,!0)),$(i,"scroll",o,!0),d&&d.disconnect()});var g=this.root&&(this.root.ownerDocument||this.root)||t;if(i!=g){var m=a(i);m&&this._monitorIntersections(m.ownerDocument)}}},c.prototype._unmonitorIntersections=function(i){var n=this._monitoringDocuments.indexOf(i);if(n!=-1){var o=this.root&&(this.root.ownerDocument||this.root)||t,l=this._observationTargets.some(function(m){var v=m.element.ownerDocument;if(v==i)return!0;for(;v&&v!=o;){var E=a(v);if(v=E&&E.ownerDocument,v==i)return!0}return!1});if(!l){var d=this._monitoringUnsubscribes[n];if(this._monitoringDocuments.splice(n,1),this._monitoringUnsubscribes.splice(n,1),d(),i!=o){var g=a(i);g&&this._unmonitorIntersections(g.ownerDocument)}}}},c.prototype._unmonitorAllIntersections=function(){var i=this._monitoringUnsubscribes.slice(0);this._monitoringDocuments.length=0,this._monitoringUnsubscribes.length=0;for(var n=0;n<i.length;n++)i[n]()},c.prototype._checkForIntersections=function(){if(!(!this.root&&r&&!s)){var i=this._rootIsInDom(),n=i?this._getRootRect():U();this._observationTargets.forEach(function(o){var l=o.element,d=k(l),g=this._rootContainsTarget(l),m=o.entry,v=i&&g&&this._computeTargetAndRootIntersection(l,d,n),E=null;this._rootContainsTarget(l)?(!r||this.root)&&(E=n):E=U();var S=o.entry=new h({time:b(),target:l,boundingClientRect:d,rootBounds:E,intersectionRect:v});m?i&&g?this._hasCrossedThreshold(m,S)&&this._queuedEntries.push(S):m&&m.isIntersecting&&this._queuedEntries.push(S):this._queuedEntries.push(S)},this),this._queuedEntries.length&&this._callback(this.takeRecords(),this)}},c.prototype._computeTargetAndRootIntersection=function(i,n,o){if(window.getComputedStyle(i).display!="none"){for(var l=n,d=N(i),g=!1;!g&&d;){var m=null,v=d.nodeType==1?window.getComputedStyle(d):{};if(v.display=="none")return null;if(d==this.root||d.nodeType==9)if(g=!0,d==this.root||d==t)r&&!this.root?!s||s.width==0&&s.height==0?(d=null,m=null,l=null):m=s:m=o;else{var E=N(d),S=E&&k(E),re=E&&this._computeTargetAndRootIntersection(E,S,o);S&&re?(d=E,m=Z(S,re)):(d=null,l=null)}else{var ie=d.ownerDocument;d!=ie.body&&d!=ie.documentElement&&v.overflow!="visible"&&(m=k(d))}if(m&&(l=j(m,l)),!l)break;d=d&&N(d)}return l}},c.prototype._getRootRect=function(){var i;if(this.root&&!te(this.root))i=k(this.root);else{var n=te(this.root)?this.root:t,o=n.documentElement,l=n.body;i={top:0,left:0,right:o.clientWidth||l.clientWidth,width:o.clientWidth||l.clientWidth,bottom:o.clientHeight||l.clientHeight,height:o.clientHeight||l.clientHeight}}return this._expandRectByRootMargin(i)},c.prototype._expandRectByRootMargin=function(i){var n=this._rootMarginValues.map(function(l,d){return l.unit=="px"?l.value:l.value*(d%2?i.width:i.height)/100}),o={top:i.top-n[0],right:i.right+n[1],bottom:i.bottom+n[2],left:i.left-n[3]};return o.width=o.right-o.left,o.height=o.bottom-o.top,o},c.prototype._hasCrossedThreshold=function(i,n){var o=i&&i.isIntersecting?i.intersectionRatio||0:-1,l=n.isIntersecting?n.intersectionRatio||0:-1;if(o!==l)for(var d=0;d<this.thresholds.length;d++){var g=this.thresholds[d];if(g==o||g==l||g<o!=g<l)return!0}},c.prototype._rootIsInDom=function(){return!this.root||ee(t,this.root)},c.prototype._rootContainsTarget=function(i){var n=this.root&&(this.root.ownerDocument||this.root)||t;return ee(n,i)&&(!this.root||n==i.ownerDocument)},c.prototype._registerInstance=function(){e.indexOf(this)<0&&e.push(this)},c.prototype._unregisterInstance=function(){var i=e.indexOf(this);i!=-1&&e.splice(i,1)};function b(){return window.performance&&performance.now&&performance.now()}function p(i,n){var o=null;return function(){o||(o=setTimeout(function(){i(),o=null},n))}}function y(i,n,o,l){typeof i.addEventListener=="function"?i.addEventListener(n,o,l||!1):typeof i.attachEvent=="function"&&i.attachEvent("on"+n,o)}function $(i,n,o,l){typeof i.removeEventListener=="function"?i.removeEventListener(n,o,l||!1):typeof i.detachEvent=="function"&&i.detachEvent("on"+n,o)}function j(i,n){var o=Math.max(i.top,n.top),l=Math.min(i.bottom,n.bottom),d=Math.max(i.left,n.left),g=Math.min(i.right,n.right),m=g-d,v=l-o;return m>=0&&v>=0&&{top:o,bottom:l,left:d,right:g,width:m,height:v}||null}function k(i){var n;try{n=i.getBoundingClientRect()}catch(o){}return n?(n.width&&n.height||(n={top:n.top,right:n.right,bottom:n.bottom,left:n.left,width:n.right-n.left,height:n.bottom-n.top}),n):U()}function U(){return{top:0,bottom:0,left:0,right:0,width:0,height:0}}function Y(i){return!i||"x"in i?i:{top:i.top,y:i.top,bottom:i.bottom,left:i.left,x:i.left,right:i.right,width:i.width,height:i.height}}function Z(i,n){var o=n.top-i.top,l=n.left-i.left;return{top:o,left:l,height:n.height,width:n.width,bottom:o+n.height,right:l+n.width}}function ee(i,n){for(var o=n;o;){if(o==i)return!0;o=N(o)}return!1}function N(i){var n=i.parentNode;return i.nodeType==9&&i!=t?a(i):(n&&n.assignedSlot&&(n=n.assignedSlot.parentNode),n&&n.nodeType==11&&n.host?n.host:n)}function te(i){return i&&i.nodeType===9}window.IntersectionObserver=c,window.IntersectionObserverEntry=h})();var w=class extends HTMLElement{constructor(){super();this.container=this.querySelector(".library-list"),this.itemTemplate=""}connectedCallback(){this.itemTemplate=this.template()}onLibraryBookExist(e,r,s){return L(this,null,function*(){let h=Object.entries(s);this.loading(h.length),e&&(e.disabled=!0);let c=h.map(($,j)=>L(this,[$,j],function*([b,p],y){try{let k=yield M.fetch(`/book-exist?isbn13=${r}&libCode=${b}`);this.renderBookExist(k,p,y)}catch(k){throw console.error(k),new Error("Fail to get usage analysis list.")}}));try{yield Promise.all(c),this.removeLoading()}catch(b){console.error("Failed to fetch data for some libraries")}})}renderBookExist(e,r,s){let{hasBook:h,loanAvailable:c}=e,b=h==="Y"?c==="Y"?"| \uB300\uCD9C\uAC00\uB2A5":"| \uB300\uCD9C\uBD88\uAC00":"",p=this.querySelectorAll(".library-item")[s];p.querySelector(".name").textContent=`\u2219 ${r} : `,p.querySelector(".hasBook").textContent=h==="Y"?"\uC18C\uC7A5":"\uBBF8\uC18C\uC7A5",p.querySelector(".loanAvailable").textContent=b}loading(e){let r="";for(;e>0;)r+=this.itemTemplate,e--;this.container.innerHTML=r}removeLoading(){this.querySelectorAll(".library-item[data-loading=true]").forEach(e=>{delete e.dataset.loading})}template(){return`<li class="library-item" data-loading="true">
            <span class="name"></span>
            <span class="hasBook"></span>
            <span class="loanAvailable"></span>
        </li>`}};var x=class extends HTMLElement{constructor(){super();this.sizeElement=null;this.PATHS=["/search","/favorite","/popular","/library","/setting"],this.sizeElement=null,this.renderBookSize=this.renderBookSize.bind(this)}connectedCallback(){this.render(),this.setSelectedMenu(),this.sizeElement=this.querySelector(".size"),u.subscribeFavoriteBookUpdate(this.renderBookSize),u.subscribeToBookStateUpdate(this.renderBookSize)}disconnectedCallback(){u.unsubscribeFavoriteBookUpdate(this.renderBookSize),u.unsubscribeFavoriteBookUpdate(this.renderBookSize)}get bookSize(){return Object.values(u.favorites).reduce((e,r)=>e+r.length,0)}render(){this.innerHTML=`
            <nav class="gnb">
                <a class="gnb-item" href=".${this.PATHS[0]}">\uCC45 \uAC80\uC0C9</a>
                <a class="gnb-item" href=".${this.PATHS[1]}">\uB098\uC758 \uCC45 (<span class="size">${this.bookSize}</span>)</a>
                <a class="gnb-item" href=".${this.PATHS[2]}">\uC778\uAE30\uB300\uCD9C\uB3C4\uC11C</a>
                <a class="gnb-item" href=".${this.PATHS[3]}">\uB3C4\uC11C\uAD00 \uC870\uD68C</a>
                <a class="gnb-item" href=".${this.PATHS[4]}">\uC124\uC815</a>
            </nav>`}setSelectedMenu(){let e=this.PATHS.indexOf(document.location.pathname);e>=0&&(this.querySelectorAll("a")[e].ariaSelected="true")}renderBookSize(){this.sizeElement&&(this.sizeElement.textContent=this.bookSize.toString())}};var P=class extends HTMLElement{constructor(){super()}show(){this.removeAttribute("hidden")}hide(){this.setAttribute("hidden","")}};customElements.define("loading-component",P);function H(a){let t=a.content.firstElementChild;if(!t)throw new Error("Template content is empty");return t.cloneNode(!0)}function he(a,t){Object.entries(a).forEach(([e,r])=>{let s=t.querySelector(`.${e}`);s.textContent=String(r)})}var D=class{constructor(t){this.component=t}render(c){var b=c,{bookImageURL:t,bookname:e,description:r,isbn13:s}=b,h=ae(b,["bookImageURL","bookname","description","isbn13"]);this.component.querySelector(".book-summary a").appendChild(new C(t,e));let y=this.component.querySelector("book-description");y.data=r;let $=this.component.querySelector("a");$.href=`/book?isbn=${s}`;let j=W(T({},h),{bookname:e,isbn13:s});he(j,this.component),this.component.libraryButton&&Object.keys(u.libraries).length===0&&(this.component.libraryButton.hidden=!0)}renderError(){this.component.dataset.fail="true",this.component.querySelector(".bookname").textContent=`ISBN : ${this.component.isbn}`,this.component.querySelector(".authors").textContent="\uC815\uBCF4\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4."}updateOnLibrary(){this.component.libraryButton&&(this.component.libraryButton.hidden=!0),this.component.libraryHideButton&&(this.component.libraryHideButton.hidden=!1),this.component.libraryBookExist&&(this.component.libraryBookExist.hidden=!1)}updateOnHideLibrary(){this.component.libraryButton&&(this.component.libraryButton.disabled=!1,this.component.libraryButton.hidden=!1),this.component.libraryHideButton&&(this.component.libraryHideButton.hidden=!0),this.component.libraryBookExist&&(this.component.libraryBookExist.hidden=!0)}};var I=class extends HTMLElement{constructor(e){super();this.loadingComponent=null;this._isbn=null;this.kyoboButton=null;this.kyoboInfoCpnt=null;this.libraryButton=null;this._isbn=e,this.ui=new D(this),this.onLibrary=this.onLibrary.bind(this),this.onHideLibrary=this.onHideLibrary.bind(this),this.onShowKyobo=this.onShowKyobo.bind(this)}get isbn(){return this._isbn}connectedCallback(){var e,r,s;this.loadingComponent=this.querySelector("loading-component"),this.libraryButton=this.querySelector(".library-button"),this.libraryHideButton=this.querySelector(".hide-button"),this.libraryBookExist=this.querySelector("library-book-exist"),this.kyoboButton=this.querySelector(".kyoboInfo-button"),this.kyoboInfoCpnt=this.querySelector("kyobo-info"),this.fetchData(),(e=this.libraryButton)==null||e.addEventListener("click",this.onLibrary),(r=this.libraryHideButton)==null||r.addEventListener("click",this.onHideLibrary),(s=this.kyoboButton)==null||s.addEventListener("click",this.onShowKyobo)}disconnectedCallback(){var e,r;(e=this.libraryButton)==null||e.removeEventListener("click",this.onLibrary),(r=this.libraryHideButton)==null||r.removeEventListener("click",this.onHideLibrary)}fetchData(){return L(this,null,function*(){var r;let e=`/usage-analysis-list?isbn13=${this._isbn}`;try{let s=yield M.fetch(e);this.renderUI(s.book)}catch(s){this.ui.renderError(),console.error(`${s}, Fail to get usage-analysis-list.`)}(r=this.loadingComponent)==null||r.hide()})}renderUI(e){delete e.vol,this.ui.render(e)}onLibrary(){!this.libraryBookExist||!this.libraryButton||(this.libraryBookExist.onLibraryBookExist(this.libraryButton,this._isbn,u.libraries),this.ui.updateOnLibrary())}onHideLibrary(){var r;let e=(r=this.libraryBookExist)==null?void 0:r.querySelector("ul");e.innerHTML="",this.ui.updateOnHideLibrary()}onShowKyobo(){var e;(e=this.kyoboInfoCpnt)==null||e.show()}};var q=class extends HTMLElement{constructor(){super();this.currentCategory=new URLSearchParams(location.search).get("category"),this.listElement=this.querySelector(".favorite-books"),this.itemTemplate=document.querySelector("#tp-favorite-item"),this.messageTemplate=document.querySelector("#tp-message")}connectedCallback(){let e=this.getIsbnsOfCategory();e&&this.render(e)}disconnectedCallback(){}getIsbnsOfCategory(){let e=u.sortedFavoriteKeys;if(e.length===0){this.renderMessage("\uAD00\uC2EC \uCE74\uD14C\uACE0\uB9AC\uB97C \uB4F1\uB85D\uD574\uC8FC\uC138\uC694.");return}let r=u.favorites[this.currentCategory||e[0]];if(r.length===0){this.renderMessage("\uB4F1\uB85D\uB41C \uAD00\uC2EC\uCC45\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.");return}return r}render(e){if(!this.listElement)return;let r=new DocumentFragment;e.map(s=>this.createItem(s)).forEach(s=>r.appendChild(s)),this.listElement.innerHTML="",this.listElement.appendChild(r)}createItem(e){let r=new I(e);return r.appendChild(this.itemTemplate.content.cloneNode(!0)),r.dataset.isbn=e,r}renderMessage(e){if(!this.messageTemplate||!this.listElement)return;let r=H(this.messageTemplate);r.textContent=e,this.listElement.appendChild(r)}};var A=class extends HTMLElement{constructor(){super();this.nav=this.querySelector(".favorite-category"),this.overlayCategory=document.querySelector("overlay-category"),this.changButton=this.querySelector(".favorite-changeButton"),this.category=null,this.handleOverlayCatalog=this.handleOverlayCatalog.bind(this),this.subscribeCategoryChange=this.subscribeCategoryChange.bind(this)}connectedCallback(){this.intialize(),this.render(),this.changButton.addEventListener("click",this.handleOverlayCatalog),u.subscribeFavoriteCategoriesUpdate(this.subscribeCategoryChange)}disconnectedCallback(){this.changButton.removeEventListener("click",this.handleOverlayCatalog),u.unsubscribeFavoriteCategoriesUpdate(this.subscribeCategoryChange)}intialize(){this.category=new URLSearchParams(location.search).get("category")||u.sortedFavoriteKeys[0]}render(){let e=new DocumentFragment;u.sortedFavoriteKeys.map(r=>this.createItem(r)).forEach(r=>e.appendChild(r)),this.nav.innerHTML="",this.nav.appendChild(e),this.hidden=!1}createItem(e){let r=document.createElement("a");return r.ariaSelected=(e===this.category).toString(),this.updateItem(r,e),r}updateItem(e,r){e.textContent=r,e.href=`?${this.getUrl(r)}`}handleOverlayCatalog(){this.overlayCategory.hidden=!this.overlayCategory.hidden}getUrl(e){return`category=${encodeURIComponent(e)}`}subscribeCategoryChange({type:e,payload:r}){let s={add:()=>this.handlAdd(r.name),rename:()=>this.handlRename(r.prevName,r.newName),delete:()=>this.handlDelete(r.name),change:()=>this.handlChange(r.targetIndex,r.draggedIndex)};s[e]?s[e]():console.error("No subscribe type")}handlAdd(e){this.nav.appendChild(this.createItem(e))}handlRename(e,r){this.updateItem(this.nav.querySelectorAll("a")[u.sortedFavoriteKeys.indexOf(e)],r),u.renameSortedFavoriteKey(e,r),this.category===e&&(location.search=this.getUrl(r))}handlDelete(e){let r=u.deleteSortedFavoriteKey(e);this.nav.querySelectorAll("a")[r].remove()}handlChange(e,r){let s=this.nav.querySelectorAll("a"),h=s[r],c=s[e];h.replaceWith(c.cloneNode(!0)),c.replaceWith(h.cloneNode(!0))}};var K=class extends HTMLElement{constructor(){super();this.draggedItem=null;this.handleClickAdd=()=>{var h;if(!this.addInput)return;let e=this.addInput.value;if(!e)return;if(u.hasFavorite(e)){alert("\uC911\uBCF5\uB41C \uC774\uB984\uC785\uB2C8\uB2E4."),this.addInput.value="";return}u.addfavorite(e);let r=u.sortedFavoriteKeys.length,s=this.createItem(e,r);(h=this.list)==null||h.appendChild(s),this.addInput.value=""};this.handleSubmit=e=>{e.preventDefault(),this.handleClickAdd()};this.handleClose=()=>{this.hidden=!0};this.form=this.querySelector("form"),this.list=this.querySelector(".category-list"),this.template=document.querySelector("#tp-category-item"),this.renameButton=this.querySelector(".rename"),this.addButton=this.querySelector(".addButton"),this.addInput=this.querySelector("input[name='add']"),this.closeButton=this.querySelector(".closeButton"),this.draggedItem=null,this.handleRename=this.handleRename.bind(this)}static get observedAttributes(){return["hidden"]}connectedCallback(){var e,r,s;this.render(),(e=this.addButton)==null||e.addEventListener("click",this.handleClickAdd),(r=this.form)==null||r.addEventListener("submit",this.handleSubmit),(s=this.closeButton)==null||s.addEventListener("click",this.handleClose)}disconnectedCallback(){var e,r,s;(e=this.addButton)==null||e.removeEventListener("click",this.handleClickAdd),(r=this.form)==null||r.removeEventListener("submit",this.handleSubmit),(s=this.closeButton)==null||s.removeEventListener("click",this.handleClose)}attributeChangedCallback(e){e==="hidden"&&!this.hasAttribute("hidden")&&this.initial()}initial(){this.list&&(this.list.innerHTML="",this.render())}render(){if(!this.list)return;let e=new DocumentFragment;u.sortedFavoriteKeys.forEach((r,s)=>{let h=this.createItem(r,s);e.appendChild(h)}),this.list.appendChild(e)}createItem(e,r){if(this.template===null)throw new Error("Template is null");let s=H(this.template);s.dataset.index=r.toString(),s.dataset.favorite=e;let h=s.querySelector("input[name='category']");return h&&(h.value=e),this.handleItemEvent(s,h,e),this.changeItem(s),s}handleItemEvent(e,r,s){var h,c;(h=e.querySelector(".renameButton"))==null||h.addEventListener("click",()=>{let b=e.dataset.favorite;this.handleRename(r,b,e)}),(c=e.querySelector(".deleteButton"))==null||c.addEventListener("click",()=>this.handleDelete(e,s)),e.addEventListener("keydown",b=>{let p=b.target;b.key==="Enter"&&p.name==="category"&&this.handleRename(p,s)})}handleRename(e,r,s){let h=e.value;!h||r===h||!s||(s.dataset.favorite=h,u.renameFavorite(r,h))}handleDelete(e,r){e.remove(),u.deleteFavorite(r)}changeItem(e){let r=e.querySelector(".dragger");r.addEventListener("mousedown",()=>{e.draggable=!0}),r.addEventListener("mouseup",()=>{e.removeAttribute("draggable")}),e.addEventListener("dragstart",()=>{this.draggedItem=e,e.draggable=!0}),e.addEventListener("dragend",()=>{this.draggedItem===e&&(this.draggedItem=null,e.removeAttribute("draggable"))}),e.addEventListener("dragover",s=>{s.preventDefault()}),e.addEventListener("dragenter",()=>{this.draggedItem!==e&&(e.dataset.drag="dragenter")}),e.addEventListener("drop",()=>{if(!this.draggedItem||!this.list)return;this.list.insertBefore(this.draggedItem,e);let s=this.draggedItem.dataset.favorite,h=e.dataset.favorite;s&&h&&u.changeFavorite(s,h),delete e.dataset.drag})}};var V=class extends HTMLElement{constructor(){super();this._isbn=null;this._isbn=this.getIsbn()||null,this.listElement=this.querySelector("ul"),this.template=this.querySelector("#tp-kyoboInfoItem")}connectedCallback(){}disconnectedCallback(){}show(){this.fetch()}getIsbn(){let e=this.closest("[data-isbn]");if(e)return e.dataset.isbn}fetch(){return L(this,null,function*(){let e=`/kyobo-book?isbn=${this._isbn}`;try{let r=yield M.fetch(e);this.render(r)}catch(r){r instanceof Error?console.error(`Error fetching books: ${r.message}`):console.error("An unexpected error occurred")}})}render(e){this.listElement.innerHTML="";let r=new DocumentFragment;e.map(({href:s,prodType:h,prodPrice:c})=>{let b=H(this.template),p=b.querySelector("a");p.href=s;let y=b.querySelector("span");return y.textContent=`\u30FB ${h} : ${c}`,b}).forEach(s=>r.appendChild(s)),this.listElement.appendChild(r),this.hidden=!1}};customElements.define("book-image",C);customElements.define("nav-gnb",x);customElements.define("favorite-item",I);customElements.define("app-favorite",q);customElements.define("favorite-nav",A);customElements.define("book-description",_);customElements.define("library-book-exist",w);customElements.define("category-selector",B);customElements.define("overlay-category",K);customElements.define("kyobo-info",V);})();
