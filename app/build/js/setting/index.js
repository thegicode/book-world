"use strict";(()=>{var re=Object.defineProperty,se=Object.defineProperties;var ne=Object.getOwnPropertyDescriptors;var X=Object.getOwnPropertySymbols;var oe=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable;var Z=(u,e,t)=>e in u?re(u,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):u[e]=t,y=(u,e)=>{for(var t in e||(e={}))oe.call(e,t)&&Z(u,t,e[t]);if(X)for(var t of X(e))ae.call(e,t)&&Z(u,t,e[t]);return u},ee=(u,e)=>se(u,ne(e));var M=(u,e,t)=>new Promise((n,o)=>{var h=b=>{try{g(t.next(b))}catch(E){o(E)}},a=b=>{try{g(t.throw(b))}catch(E){o(E)}},g=b=>b.done?n(b.value):Promise.resolve(b.value).then(h,a);g((t=t.apply(u,e)).next())});var N="BookWorld";var v=class{constructor(){this.subscribers=[]}subscribe(e){this.subscribers.push(e)}unsubscribe(e){this.subscribers=this.subscribers.filter(t=>t!==e)}notify(e){this.subscribers.forEach(t=>t(e))}};var x=class{constructor(e,t){this.categoriesUpdatePublisher=new v;this.bookUpdatePublisher=new v;this._favorites=e||{},this._sortedKeys=t||[]}get favorites(){return y({},this._favorites)}set favorites(e){this._favorites=e}get sortedKeys(){return[...this._sortedKeys]}set sortedKeys(e){this._sortedKeys=e}add(e){this._favorites[e]=[],this.categoriesUpdatePublisher.notify({type:"add",payload:{name:e}})}addSortedKeys(e){this._sortedKeys.push(e)}rename(e,t){e in this._favorites&&(this._favorites[t]=this._favorites[e],delete this._favorites[e],this.categoriesUpdatePublisher.notify({type:"rename",payload:{prevName:e,newName:t}}))}renameSortedKeys(e,t){let n=this._sortedKeys.indexOf(e);n!==-1&&(this._sortedKeys[n]=t)}change(e,t){let n=this._sortedKeys.indexOf(e),o=this._sortedKeys.indexOf(t);this._sortedKeys[o]=e,this._sortedKeys[n]=t,this.categoriesUpdatePublisher.notify({type:"change",payload:{targetIndex:o,draggedIndex:n}})}delete(e){delete this._favorites[e],this.categoriesUpdatePublisher.notify({type:"delete",payload:{name:e}})}deleteSortedKeys(e){let t=this._sortedKeys.indexOf(e);return this._sortedKeys.splice(t,1),t}has(e){return e in this._favorites}addBook(e,t){e in this._favorites&&this._favorites[e].unshift(t),this.bookUpdatePublisher.notify()}hasBook(e,t){return e in this._favorites&&this._favorites[e].includes(t)}removeBook(e,t){if(e in this._favorites){let n=this._favorites[e].indexOf(t);n!=-1&&this._favorites[e].splice(n,1)}this.bookUpdatePublisher.notify()}subscribeCategoriesUpdate(e){this.categoriesUpdatePublisher.subscribe(e)}unsubscribeCategoriesUpdate(e){this.categoriesUpdatePublisher.unsubscribe(e)}subscribeBookUpdate(e){this.bookUpdatePublisher.subscribe(e)}unsubscribeBookUpdate(e){this.bookUpdatePublisher.unsubscribe(e)}};var I=class{constructor(e){this.publisher=new v;this._libraries=e}get libraries(){return y({},this._libraries)}set libraries(e){this._libraries=e}add(e,t){this._libraries[e]=t,this.publisher.notify({type:"add",payload:{code:e,name:t}})}remove(e){delete this._libraries[e],this.publisher.notify({type:"delete",payload:{code:e}})}has(e){return e in this._libraries}subscribeUpdate(e){this.publisher.subscribe(e)}unsubscribeUpdate(e){this.publisher.subscribe(e)}};var D=class{constructor(e){this.updatePublisher=new v;this.detailUpdatePublisher=new v;this._regions=e}get regions(){return y({},this._regions)}set regions(e){this._regions=e}add(e){this._regions[e]={},this.updatePublisher.notify()}remove(e){delete this._regions[e],this.updatePublisher.notify()}addDetail(e,t,n){e in this._regions&&(this._regions[e][t]=n),this.detailUpdatePublisher.notify()}removeDetail(e,t){e in this._regions&&t in this._regions[e]&&delete this._regions[e][t],this.detailUpdatePublisher.notify()}subscribeUpdatePublisher(e){this.updatePublisher.subscribe(e)}unsubscribeUpdatePublisher(e){this.updatePublisher.unsubscribe(e)}subscribeDetailUpdatePublisher(e){this.detailUpdatePublisher.subscribe(e)}unsubscribeDetailUpdatePublisher(e){this.detailUpdatePublisher.unsubscribe(e)}};var le=u=>JSON.parse(JSON.stringify(u)),te={favorites:{},sortedFavoriteKeys:[],libraries:{},regions:{}},j=class{constructor(){this.bookStateUpdatePublisher=new v;let e=this.loadStorage()||le(te),{favorites:t,sortedFavoriteKeys:n,libraries:o,regions:h}=e;this.favoriteModel=new x(t,n),this.libraryModel=new I(o),this.regionModel=new D(h)}loadStorage(){let e=localStorage.getItem(N);return e?JSON.parse(e):null}setStorage(e){try{localStorage.setItem(N,JSON.stringify(e))}catch(t){console.error(t)}}get state(){return this.loadStorage()}set state(e){this.setStorage(e);let{favorites:t,sortedFavoriteKeys:n,libraries:o,regions:h}=e;this.favoriteModel.favorites=t,this.favoriteModel.sortedKeys=n,this.libraryModel.libraries=o,this.regionModel.regions=h,this.bookStateUpdatePublisher.notify(),console.log("set state")}get favorites(){return this.favoriteModel.favorites}get sortedFavoriteKeys(){return this.favoriteModel.sortedKeys}get libraries(){return this.libraryModel.libraries}get regions(){return this.regionModel.regions}resetState(){this.state=te}setFavorites(){let e=this.state;e.favorites=this.favorites,e.sortedFavoriteKeys=this.sortedFavoriteKeys,this.setStorage(e)}addfavorite(e){this.favoriteModel.add(e),this.favoriteModel.addSortedKeys(e),this.setFavorites()}renameFavorite(e,t){this.favoriteModel.rename(e,t),this.setFavorites()}renameSortedFavoriteKey(e,t){this.favoriteModel.renameSortedKeys(e,t),this.setFavorites()}deleteFavorite(e){this.favoriteModel.delete(e),this.setFavorites()}deleteSortedFavoriteKey(e){let t=this.favoriteModel.deleteSortedKeys(e);return this.setFavorites(),t}hasFavorite(e){return this.favoriteModel.has(e)}changeFavorite(e,t){this.favoriteModel.change(e,t),this.setFavorites()}addFavoriteBook(e,t){this.favoriteModel.addBook(e,t),this.setFavorites()}hasFavoriteBook(e,t){return this.favoriteModel.hasBook(e,t)}removeFavoriteBook(e,t){this.favoriteModel.removeBook(e,t),this.setFavorites()}setLibraries(){let e=this.state;e.libraries=this.libraries,this.setStorage(e)}addLibraries(e,t){this.libraryModel.add(e,t),this.setLibraries()}removeLibraries(e){this.libraryModel.remove(e),this.setLibraries()}hasLibrary(e){return this.libraryModel.has(e)}setRegions(){let e=this.state;e.regions=this.regions,this.setStorage(e)}addRegion(e){this.regionModel.add(e),this.setRegions()}removeRegion(e){this.regionModel.remove(e),this.setRegions()}addDetailRegion(e,t,n){this.regionModel.addDetail(e,t,n),this.setRegions()}removeDetailRegion(e,t){this.regionModel.removeDetail(e,t),this.setRegions()}subscribeToBookStateUpdate(e){this.bookStateUpdatePublisher.subscribe(e)}unsubscribeToBookStateUpdate(e){this.bookStateUpdatePublisher.unsubscribe(e)}subscribeFavoriteCategoriesUpdate(e){this.favoriteModel.subscribeCategoriesUpdate(e)}unsubscribeFavoriteCategoriesUpdate(e){this.favoriteModel.unsubscribeCategoriesUpdate(e)}subscribeFavoriteBookUpdate(e){this.favoriteModel.subscribeBookUpdate(e)}unsubscribeFavoriteBookUpdate(e){this.favoriteModel.unsubscribeBookUpdate(e)}subscribeLibraryUpdate(e){this.libraryModel.subscribeUpdate(e)}unsubscribeLibraryUpdate(e){this.libraryModel.unsubscribeUpdate(e)}subscribeRegionUpdate(e){this.regionModel.subscribeUpdatePublisher(e)}unsubscribeRegionUpdate(e){this.regionModel.unsubscribeUpdatePublisher(e)}subscribeDetailRegionUpdate(e){this.regionModel.subscribeDetailUpdatePublisher(e)}unsubscribeDetailRegionUpdate(e){this.regionModel.unsubscribeDetailUpdatePublisher(e)}},ce=new j,d=ce;var z=class{constructor(){this._bus=document.createElement("div")}add(e,t){this._bus.addEventListener(e,t)}remove(e,t){this._bus.removeEventListener(e,t)}dispatch(e,t={}){this._bus.dispatchEvent(new CustomEvent(e,{detail:t}))}},C=new z;var $=class{constructor(e={}){this.defaultOptions=y({method:"GET",headers:{"Content-Type":"application/json"}},e)}fetch(e,t){return M(this,null,function*(){let n=ee(y(y({},this.defaultOptions),t),{timeout:5e3});try{let o=yield fetch(e,n);if(!o.ok)throw new Error(`Http error! status: ${o.status}, message: ${o.statusText}`);return yield o.json()}catch(o){throw console.error(`Error fetching data: ${o}`),new Error(`Error fetching data: ${o}`)}})}},k=new $;(function(){"use strict";if(typeof window!="object")return;if("IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype){"isIntersecting"in window.IntersectionObserverEntry.prototype||Object.defineProperty(window.IntersectionObserverEntry.prototype,"isIntersecting",{get:function(){return this.intersectionRatio>0}});return}function u(i){try{return i.defaultView&&i.defaultView.frameElement||null}catch(r){return null}}var e=function(i){for(var r=i,s=u(r);s;)r=s.ownerDocument,s=u(r);return r}(window.document),t=[],n=null,o=null;function h(i){this.time=i.time,this.target=i.target,this.rootBounds=V(i.rootBounds),this.boundingClientRect=V(i.boundingClientRect),this.intersectionRect=V(i.intersectionRect||w()),this.isIntersecting=!!i.intersectionRect;var r=this.boundingClientRect,s=r.width*r.height,l=this.intersectionRect,c=l.width*l.height;s?this.intersectionRatio=Number((c/s).toFixed(4)):this.intersectionRatio=this.isIntersecting?1:0}function a(i,r){var s=r||{};if(typeof i!="function")throw new Error("callback must be a function");if(s.root&&s.root.nodeType!=1&&s.root.nodeType!=9)throw new Error("root must be a Document or Element");this._checkForIntersections=b(this._checkForIntersections.bind(this),this.THROTTLE_TIMEOUT),this._callback=i,this._observationTargets=[],this._queuedEntries=[],this._rootMarginValues=this._parseRootMargin(s.rootMargin),this.thresholds=this._initThresholds(s.threshold),this.root=s.root||null,this.rootMargin=this._rootMarginValues.map(function(l){return l.value+l.unit}).join(" "),this._monitoringDocuments=[],this._monitoringUnsubscribes=[]}a.prototype.THROTTLE_TIMEOUT=100,a.prototype.POLL_INTERVAL=null,a.prototype.USE_MUTATION_OBSERVER=!0,a._setupCrossOriginUpdater=function(){return n||(n=function(i,r){!i||!r?o=w():o=W(i,r),t.forEach(function(s){s._checkForIntersections()})}),n},a._resetCrossOriginUpdater=function(){n=null,o=null},a.prototype.observe=function(i){var r=this._observationTargets.some(function(s){return s.element==i});if(!r){if(!(i&&i.nodeType==1))throw new Error("target must be an Element");this._registerInstance(),this._observationTargets.push({element:i,entry:null}),this._monitorIntersections(i.ownerDocument),this._checkForIntersections()}},a.prototype.unobserve=function(i){this._observationTargets=this._observationTargets.filter(function(r){return r.element!=i}),this._unmonitorIntersections(i.ownerDocument),this._observationTargets.length==0&&this._unregisterInstance()},a.prototype.disconnect=function(){this._observationTargets=[],this._unmonitorAllIntersections(),this._unregisterInstance()},a.prototype.takeRecords=function(){var i=this._queuedEntries.slice();return this._queuedEntries=[],i},a.prototype._initThresholds=function(i){var r=i||[0];return Array.isArray(r)||(r=[r]),r.sort().filter(function(s,l,c){if(typeof s!="number"||isNaN(s)||s<0||s>1)throw new Error("threshold must be a number between 0 and 1 inclusively");return s!==c[l-1]})},a.prototype._parseRootMargin=function(i){var r=i||"0px",s=r.split(/\s+/).map(function(l){var c=/^(-?\d*\.?\d+)(px|%)$/.exec(l);if(!c)throw new Error("rootMargin must be specified in pixels or percent");return{value:parseFloat(c[1]),unit:c[2]}});return s[1]=s[1]||s[0],s[2]=s[2]||s[0],s[3]=s[3]||s[1],s},a.prototype._monitorIntersections=function(i){var r=i.defaultView;if(r&&this._monitoringDocuments.indexOf(i)==-1){var s=this._checkForIntersections,l=null,c=null;this.POLL_INTERVAL?l=r.setInterval(s,this.POLL_INTERVAL):(E(r,"resize",s,!0),E(i,"scroll",s,!0),this.USE_MUTATION_OBSERVER&&"MutationObserver"in r&&(c=new r.MutationObserver(s),c.observe(i,{attributes:!0,childList:!0,characterData:!0,subtree:!0}))),this._monitoringDocuments.push(i),this._monitoringUnsubscribes.push(function(){var f=i.defaultView;f&&(l&&f.clearInterval(l),_(f,"resize",s,!0)),_(i,"scroll",s,!0),c&&c.disconnect()});var m=this.root&&(this.root.ownerDocument||this.root)||e;if(i!=m){var p=u(i);p&&this._monitorIntersections(p.ownerDocument)}}},a.prototype._unmonitorIntersections=function(i){var r=this._monitoringDocuments.indexOf(i);if(r!=-1){var s=this.root&&(this.root.ownerDocument||this.root)||e,l=this._observationTargets.some(function(p){var f=p.element.ownerDocument;if(f==i)return!0;for(;f&&f!=s;){var T=u(f);if(f=T&&T.ownerDocument,f==i)return!0}return!1});if(!l){var c=this._monitoringUnsubscribes[r];if(this._monitoringDocuments.splice(r,1),this._monitoringUnsubscribes.splice(r,1),c(),i!=s){var m=u(i);m&&this._unmonitorIntersections(m.ownerDocument)}}}},a.prototype._unmonitorAllIntersections=function(){var i=this._monitoringUnsubscribes.slice(0);this._monitoringDocuments.length=0,this._monitoringUnsubscribes.length=0;for(var r=0;r<i.length;r++)i[r]()},a.prototype._checkForIntersections=function(){if(!(!this.root&&n&&!o)){var i=this._rootIsInDom(),r=i?this._getRootRect():w();this._observationTargets.forEach(function(s){var l=s.element,c=q(l),m=this._rootContainsTarget(l),p=s.entry,f=i&&m&&this._computeTargetAndRootIntersection(l,c,r),T=null;this._rootContainsTarget(l)?(!n||this.root)&&(T=r):T=w();var S=s.entry=new h({time:g(),target:l,boundingClientRect:c,rootBounds:T,intersectionRect:f});p?i&&m?this._hasCrossedThreshold(p,S)&&this._queuedEntries.push(S):p&&p.isIntersecting&&this._queuedEntries.push(S):this._queuedEntries.push(S)},this),this._queuedEntries.length&&this._callback(this.takeRecords(),this)}},a.prototype._computeTargetAndRootIntersection=function(i,r,s){if(window.getComputedStyle(i).display!="none"){for(var l=r,c=K(i),m=!1;!m&&c;){var p=null,f=c.nodeType==1?window.getComputedStyle(c):{};if(f.display=="none")return null;if(c==this.root||c.nodeType==9)if(m=!0,c==this.root||c==e)n&&!this.root?!o||o.width==0&&o.height==0?(c=null,p=null,l=null):p=o:p=s;else{var T=K(c),S=T&&q(T),J=T&&this._computeTargetAndRootIntersection(T,S,s);S&&J?(c=T,p=W(S,J)):(c=null,l=null)}else{var Q=c.ownerDocument;c!=Q.body&&c!=Q.documentElement&&f.overflow!="visible"&&(p=q(c))}if(p&&(l=ie(p,l)),!l)break;c=c&&K(c)}return l}},a.prototype._getRootRect=function(){var i;if(this.root&&!G(this.root))i=q(this.root);else{var r=G(this.root)?this.root:e,s=r.documentElement,l=r.body;i={top:0,left:0,right:s.clientWidth||l.clientWidth,width:s.clientWidth||l.clientWidth,bottom:s.clientHeight||l.clientHeight,height:s.clientHeight||l.clientHeight}}return this._expandRectByRootMargin(i)},a.prototype._expandRectByRootMargin=function(i){var r=this._rootMarginValues.map(function(l,c){return l.unit=="px"?l.value:l.value*(c%2?i.width:i.height)/100}),s={top:i.top-r[0],right:i.right+r[1],bottom:i.bottom+r[2],left:i.left-r[3]};return s.width=s.right-s.left,s.height=s.bottom-s.top,s},a.prototype._hasCrossedThreshold=function(i,r){var s=i&&i.isIntersecting?i.intersectionRatio||0:-1,l=r.isIntersecting?r.intersectionRatio||0:-1;if(s!==l)for(var c=0;c<this.thresholds.length;c++){var m=this.thresholds[c];if(m==s||m==l||m<s!=m<l)return!0}},a.prototype._rootIsInDom=function(){return!this.root||Y(e,this.root)},a.prototype._rootContainsTarget=function(i){var r=this.root&&(this.root.ownerDocument||this.root)||e;return Y(r,i)&&(!this.root||r==i.ownerDocument)},a.prototype._registerInstance=function(){t.indexOf(this)<0&&t.push(this)},a.prototype._unregisterInstance=function(){var i=t.indexOf(this);i!=-1&&t.splice(i,1)};function g(){return window.performance&&performance.now&&performance.now()}function b(i,r){var s=null;return function(){s||(s=setTimeout(function(){i(),s=null},r))}}function E(i,r,s,l){typeof i.addEventListener=="function"?i.addEventListener(r,s,l||!1):typeof i.attachEvent=="function"&&i.attachEvent("on"+r,s)}function _(i,r,s,l){typeof i.removeEventListener=="function"?i.removeEventListener(r,s,l||!1):typeof i.detachEvent=="function"&&i.detachEvent("on"+r,s)}function ie(i,r){var s=Math.max(i.top,r.top),l=Math.min(i.bottom,r.bottom),c=Math.max(i.left,r.left),m=Math.min(i.right,r.right),p=m-c,f=l-s;return p>=0&&f>=0&&{top:s,bottom:l,left:c,right:m,width:p,height:f}||null}function q(i){var r;try{r=i.getBoundingClientRect()}catch(s){}return r?(r.width&&r.height||(r={top:r.top,right:r.right,bottom:r.bottom,left:r.left,width:r.right-r.left,height:r.bottom-r.top}),r):w()}function w(){return{top:0,bottom:0,left:0,right:0,width:0,height:0}}function V(i){return!i||"x"in i?i:{top:i.top,y:i.top,bottom:i.bottom,left:i.left,x:i.left,right:i.right,width:i.width,height:i.height}}function W(i,r){var s=r.top-i.top,l=r.left-i.left;return{top:s,left:l,height:r.height,width:r.width,bottom:s+r.height,right:l+r.width}}function Y(i,r){for(var s=r;s;){if(s==i)return!0;s=K(s)}return!1}function K(i){var r=i.parentNode;return i.nodeType==9&&i!=e?u(i):(r&&r.assignedSlot&&(r=r.assignedSlot.parentNode),r&&r.nodeType==11&&r.host?r.host:r)}function G(i){return i&&i.nodeType===9}window.IntersectionObserver=a,window.IntersectionObserverEntry=h})();var R=class extends HTMLElement{constructor(){super();this.sizeElement=null;this.PATHS=["/search","/favorite","/popular","/library","/setting"],this.sizeElement=null,this.renderBookSize=this.renderBookSize.bind(this)}connectedCallback(){this.render(),this.setSelectedMenu(),this.sizeElement=this.querySelector(".size"),d.subscribeFavoriteBookUpdate(this.renderBookSize),d.subscribeToBookStateUpdate(this.renderBookSize)}disconnectedCallback(){d.unsubscribeFavoriteBookUpdate(this.renderBookSize),d.unsubscribeFavoriteBookUpdate(this.renderBookSize)}get bookSize(){return Object.values(d.favorites).reduce((t,n)=>t+n.length,0)}render(){this.innerHTML=`
            <nav class="gnb">
                <a class="gnb-item" href=".${this.PATHS[0]}">\uCC45 \uAC80\uC0C9</a>
                <a class="gnb-item" href=".${this.PATHS[1]}">\uB098\uC758 \uCC45 (<span class="size">${this.bookSize}</span>)</a>
                <a class="gnb-item" href=".${this.PATHS[2]}">\uC778\uAE30\uB300\uCD9C\uB3C4\uC11C</a>
                <a class="gnb-item" href=".${this.PATHS[3]}">\uB3C4\uC11C\uAD00 \uC870\uD68C</a>
                <a class="gnb-item" href=".${this.PATHS[4]}">\uC124\uC815</a>
            </nav>`}setSelectedMenu(){let t=this.PATHS.indexOf(document.location.pathname);t>=0&&(this.querySelectorAll("a")[t].ariaSelected="true")}renderBookSize(){this.sizeElement&&(this.sizeElement.textContent=this.bookSize.toString())}};var U=class extends HTMLElement{constructor(){super()}show(){this.removeAttribute("hidden")}hide(){this.setAttribute("hidden","")}};customElements.define("loading-component",U);var H=class extends HTMLElement{constructor(){super()}};function L(u){let e=u.content.firstElementChild;if(!e)throw new Error("Template content is empty");return e.cloneNode(!0)}var B="fetch-region-data";var F=class extends HTMLElement{constructor(){super();this.regionData=null,this.template=document.querySelector("#tp-region"),this.fetchAndRender=this.fetchAndRender.bind(this)}connectedCallback(){this.fetchAndRender(),d.subscribeToBookStateUpdate(this.fetchAndRender)}discinnectedCallback(){d.unsubscribeToBookStateUpdate(this.fetchAndRender)}fetchAndRender(){return M(this,null,function*(){try{this.regionData=yield yield k.fetch("../../../assets/json/region.json"),this.render(),C.dispatch(B,{regionData:this.regionData})}catch(t){throw console.error(t),new Error("Fail to get region data.")}})}render(){let t=this.createRegionElementsFragment(),n=this.querySelector(".regions");n.innerHTML="",n.appendChild(t)}createRegionElementsFragment(){if(!this.regionData)throw new Error("regionData is null.");let t=new DocumentFragment,n=this.regionData.region,o=Object.keys(d.regions);for(let[h,a]of Object.entries(n)){let g=this.createRegionElement(this.template,h,a,o);t.appendChild(g)}return t}createRegionElement(t,n,o,h){let a=L(t),g=a.querySelector("input");g.value=o,g.checked=h.includes(n),g.addEventListener("change",this.createCheckboxChangeListener(g));let b=a.querySelector("span");return b&&(b.textContent=n),a}createCheckboxChangeListener(t){return()=>{let n=t.nextElementSibling;if(!n||typeof n.textContent!="string")throw new Error("Invalid checkbox element: No sibling element or missing text content.");let o=n.textContent;t.checked?d.addRegion(o):d.removeRegion(o)}}};var O=class extends HTMLElement{constructor(){super();this.regionData=null,this.region="",this.setRegionData=this.setRegionData.bind(this),this.renderRegion=this.renderRegion.bind(this)}connectedCallback(){d.subscribeRegionUpdate(this.renderRegion),C.add(B,this.setRegionData)}disconnectedCallback(){d.unsubscribeRegionUpdate(this.renderRegion),C.remove(B,this.setRegionData)}setRegionData(t){let n=t;this.regionData=n.detail.regionData,this.renderRegion()}renderRegion(){let t=Object.keys(d.regions),n=this.querySelector(".regions");if(n){if(n.innerHTML="",t.length>0){let o=this.createRegions(t);n.appendChild(o)}this.initializeFirstRegion(n)}}createRegions(t){let n=document.querySelector("#tp-favorite-region"),o=new DocumentFragment;return t.forEach(h=>{if(h==="")return null;let a=L(n),g=a.querySelector("span");g&&(g.textContent=h),o.appendChild(a)}),o}initializeFirstRegion(t){let n=t.querySelector("input");if(!n){this.renderDetailRegions("");return}n.checked=!0;let o=n.nextElementSibling,h=(o==null?void 0:o.textContent)||"";this.renderDetailRegions(h),this.changeRegion()}renderDetailRegions(t){var E;let n=this.querySelector(".detailRegions");if(!n)return;let o=d.regions[t],h=o?Object.values(o):[],a=document.querySelector("#tp-detail-region");if(!a)return;n.innerHTML="";let g=((E=this.regionData)==null?void 0:E.detailRegion[t])||{},b=this.createDetailRegionElements(g,a,h);n.appendChild(b),this.region=t,this.onChangeDetail()}createDetailRegionElements(t,n,o){let h=new DocumentFragment;for(let[a,g]of Object.entries(t)){let b=L(n),E=b.querySelector("span");E&&(E.textContent=a);let _=b.querySelector("input");_&&(_.value=g,o.includes(g)?(_.checked=!0,h.insertBefore(b,h.firstChild)):h.appendChild(b))}return h}changeRegion(){let t=this.querySelectorAll("[name=favorite-region]");Array.from(t).forEach(n=>{let o=n;o.addEventListener("change",()=>{if(o.checked){let h=o.nextElementSibling,a=(h==null?void 0:h.textContent)||"";this.renderDetailRegions(a)}})})}onChangeDetail(){let t=this.region;d.regions[t]||d.addRegion(t),document.querySelectorAll("[name=detailRegion]").forEach(o=>{let h=o;h.addEventListener("change",()=>{let{value:a}=h,g=h.nextElementSibling,b=(g==null?void 0:g.textContent)||"";h.checked?d.addDetailRegion(t,b,a):d.removeDetailRegion(t,b)})})}};var P=class extends HTMLElement{constructor(){super();this.container=null;this.template=null;this.render=this.render.bind(this)}connectedCallback(){this.container=this.querySelector(".favorites"),this.template=this.querySelector("#tp-favorites-stored"),this.render(),d.subscribeToBookStateUpdate(this.render),d.subscribeDetailRegionUpdate(this.render)}disconnectedCallback(){d.unsubscribeToBookStateUpdate(this.render),d.unsubscribeDetailRegionUpdate(this.render)}render(){if(!this.container)return;this.container.innerHTML="";let t=d.regions,n=new DocumentFragment;for(let[o,h]of Object.entries(t)){let a=this.createElement(o,h);n.appendChild(a)}this.container.appendChild(n)}createElement(t,n){var g;if(!this.template)return;let o=L(this.template),h=o.querySelector(".subTitle");h.textContent=t;let a=this.renderDetail(n);return(g=o.querySelector(".regions"))==null||g.appendChild(a),o}renderDetail(t){let n=new DocumentFragment;for(let[o,h]of Object.entries(t)){let a=document.createElement("span");a.textContent=o,a.dataset.code=h,n.appendChild(a)}return n}};var he="../../../assets/json/storage-sample.json",A=class extends HTMLElement{constructor(){super();this.saveStorage=()=>{let t=new Blob([JSON.stringify(d.state)],{type:"application/json"}),n=document.createElement("a");n.href=URL.createObjectURL(t),n.download="storage-sample.json",n.click(),URL.revokeObjectURL(n.href)};this.setDefaultState=()=>M(this,null,function*(){try{let t=yield k.fetch(he);d.state=t,console.log("Saved local stronage by base data!")}catch(t){throw console.error(t),new Error("Fail to get storage sample data.")}});this.resetStorage=()=>{d.resetState()};this.regisKey=()=>M(this,null,function*(){let t=this.regisKeyTextarea.value;if(!this.validateKey(t))return;let n=t.replace(/\n/g,"aaaaa");(yield k.fetch(`/regis-key?key=${n}`))&&console.log("success")});this.saveButton=this.querySelector(".saveStorage button"),this.defaultButton=this.querySelector(".localStorage button"),this.resetButton=this.querySelector(".resetStorage button"),this.regisKeyTextarea=this.querySelector(".regisKey textarea"),this.regisButton=this.querySelector(".regisKey button")}connectedCallback(){this.saveButton.addEventListener("click",this.saveStorage),this.defaultButton.addEventListener("click",this.setDefaultState),this.resetButton.addEventListener("click",this.resetStorage),this.regisButton.addEventListener("click",this.regisKey)}disconnectedCallback(){this.saveButton.removeEventListener("click",this.saveStorage),this.defaultButton.removeEventListener("click",this.setDefaultState),this.regisButton.removeEventListener("click",this.resetStorage),this.regisButton.removeEventListener("click",this.regisKey)}validateKey(t){return t.length>0?["LIBRARY_KEY","NAVER_CLIENT_ID","NAVER_SECRET_KEY"].every(o=>t.includes(o)):!1}};customElements.define("nav-gnb",R);customElements.define("app-setting",H);customElements.define("set-region",F);customElements.define("set-detail-region",O);customElements.define("favorite-regions",P);customElements.define("set-storage",A);})();
