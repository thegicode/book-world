"use strict";(()=>{var se=Object.defineProperty,oe=Object.defineProperties;var ne=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var X=(h,e,t)=>e in h?se(h,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):h[e]=t,E=(h,e)=>{for(var t in e||(e={}))Z.call(e,t)&&X(h,t,e[t]);if(q)for(var t of q(e))ee.call(e,t)&&X(h,t,e[t]);return h},te=(h,e)=>oe(h,ne(e));var re=(h,e)=>{var t={};for(var i in h)Z.call(h,i)&&e.indexOf(i)<0&&(t[i]=h[i]);if(h!=null&&q)for(var i of q(h))e.indexOf(i)<0&&ee.call(h,i)&&(t[i]=h[i]);return t};var k=(h,e,t)=>new Promise((i,o)=>{var a=b=>{try{d(t.next(b))}catch(T){o(T)}},l=b=>{try{d(t.throw(b))}catch(T){o(T)}},d=b=>b.done?i(b.value):Promise.resolve(b.value).then(a,l);d((t=t.apply(h,e)).next())});var w=class extends HTMLElement{constructor(t,i){super();this.image=null;this.render(t,i)}render(t,i){let o=document.createElement("img");o.className="thumb",o.src=t,o.alt=i,o.onerror=this.onError.bind(this),this.image=o,this.appendChild(o)}onError(){var t;this.dataset.fail="true",console.error("Failed to load image"),(t=this.image)==null||t.remove()}};var $="BookWorld";var v=class{constructor(){this.subscribers=[]}subscribe(e){this.subscribers.push(e)}unsubscribe(e){this.subscribers=this.subscribers.filter(t=>t!==e)}notify(e){this.subscribers.forEach(t=>t(e))}};var U=class{constructor(e,t){this.categoriesUpdatePublisher=new v;this.bookUpdatePublisher=new v;this._favorites=e||{},this._sortedKeys=t||[]}get favorites(){return E({},this._favorites)}set favorites(e){this._favorites=e}get sortedKeys(){return[...this._sortedKeys]}set sortedKeys(e){this._sortedKeys=e}add(e){this._favorites[e]=[],this.categoriesUpdatePublisher.notify({type:"add",payload:{name:e}})}addSortedKeys(e){this._sortedKeys.push(e)}rename(e,t){e in this._favorites&&(this._favorites[t]=this._favorites[e],delete this._favorites[e],this.categoriesUpdatePublisher.notify({type:"rename",payload:{prevName:e,newName:t}}))}renameSortedKeys(e,t){let i=this._sortedKeys.indexOf(e);i!==-1&&(this._sortedKeys[i]=t)}change(e,t){let i=this._sortedKeys.indexOf(e),o=this._sortedKeys.indexOf(t);this._sortedKeys[o]=e,this._sortedKeys[i]=t,this.categoriesUpdatePublisher.notify({type:"change",payload:{targetIndex:o,draggedIndex:i}})}delete(e){delete this._favorites[e],this.categoriesUpdatePublisher.notify({type:"delete",payload:{name:e}})}deleteSortedKeys(e){let t=this._sortedKeys.indexOf(e);return this._sortedKeys.splice(t,1),t}has(e){return e in this._favorites}addBook(e,t){e in this._favorites&&this._favorites[e].unshift(t),this.bookUpdatePublisher.notify()}hasBook(e,t){return e in this._favorites&&this._favorites[e].includes(t)}removeBook(e,t){if(e in this._favorites){let i=this._favorites[e].indexOf(t);i!=-1&&this._favorites[e].splice(i,1)}this.bookUpdatePublisher.notify()}subscribeCategoriesUpdate(e){this.categoriesUpdatePublisher.subscribe(e)}unsubscribeCategoriesUpdate(e){this.categoriesUpdatePublisher.unsubscribe(e)}subscribeBookUpdate(e){this.bookUpdatePublisher.subscribe(e)}unsubscribeBookUpdate(e){this.bookUpdatePublisher.unsubscribe(e)}};var B=class{constructor(e){this.publisher=new v;this._libraries=e}get libraries(){return E({},this._libraries)}set libraries(e){this._libraries=e}add(e,t){this._libraries[e]=t,this.publisher.notify({type:"add",payload:{code:e,name:t}})}remove(e){delete this._libraries[e],this.publisher.notify({type:"delete",payload:{code:e}})}has(e){return e in this._libraries}subscribeUpdate(e){this.publisher.subscribe(e)}unsubscribeUpdate(e){this.publisher.subscribe(e)}};var R=class{constructor(e){this.updatePublisher=new v;this.detailUpdatePublisher=new v;this._regions=e}get regions(){return E({},this._regions)}set regions(e){this._regions=e}add(e){this._regions[e]={},this.updatePublisher.notify()}remove(e){delete this._regions[e],this.updatePublisher.notify()}addDetail(e,t,i){e in this._regions&&(this._regions[e][t]=i),this.detailUpdatePublisher.notify()}removeDetail(e,t){e in this._regions&&t in this._regions[e]&&delete this._regions[e][t],this.detailUpdatePublisher.notify()}subscribeUpdatePublisher(e){this.updatePublisher.subscribe(e)}unsubscribeUpdatePublisher(e){this.updatePublisher.unsubscribe(e)}subscribeDetailUpdatePublisher(e){this.detailUpdatePublisher.subscribe(e)}unsubscribeDetailUpdatePublisher(e){this.detailUpdatePublisher.unsubscribe(e)}};var ae=h=>JSON.parse(JSON.stringify(h)),ie={favorites:{},sortedFavoriteKeys:[],libraries:{},regions:{}},N=class{constructor(){this.bookStateUpdatePublisher=new v;let e=this.loadStorage()||ae(ie),{favorites:t,sortedFavoriteKeys:i,libraries:o,regions:a}=e;this.favoriteModel=new U(t,i),this.libraryModel=new B(o),this.regionModel=new R(a)}loadStorage(){let e=localStorage.getItem($);return e?JSON.parse(e):null}setStorage(e){try{localStorage.setItem($,JSON.stringify(e))}catch(t){console.error(t)}}get state(){return this.loadStorage()}set state(e){this.setStorage(e);let{favorites:t,sortedFavoriteKeys:i,libraries:o,regions:a}=e;this.favoriteModel.favorites=t,this.favoriteModel.sortedKeys=i,this.libraryModel.libraries=o,this.regionModel.regions=a,this.bookStateUpdatePublisher.notify(),console.log("set state")}get favorites(){return this.favoriteModel.favorites}get sortedFavoriteKeys(){return this.favoriteModel.sortedKeys}get libraries(){return this.libraryModel.libraries}get regions(){return this.regionModel.regions}resetState(){this.state=ie}setFavorites(){let e=this.state;e.favorites=this.favorites,e.sortedFavoriteKeys=this.sortedFavoriteKeys,this.setStorage(e)}addfavorite(e){this.favoriteModel.add(e),this.favoriteModel.addSortedKeys(e),this.setFavorites()}renameFavorite(e,t){this.favoriteModel.rename(e,t),this.setFavorites()}renameSortedFavoriteKey(e,t){this.favoriteModel.renameSortedKeys(e,t),this.setFavorites()}deleteFavorite(e){this.favoriteModel.delete(e),this.setFavorites()}deleteSortedFavoriteKey(e){let t=this.favoriteModel.deleteSortedKeys(e);return this.setFavorites(),t}hasFavorite(e){return this.favoriteModel.has(e)}changeFavorite(e,t){this.favoriteModel.change(e,t),this.setFavorites()}addFavoriteBook(e,t){this.favoriteModel.addBook(e,t),this.setFavorites()}hasFavoriteBook(e,t){return this.favoriteModel.hasBook(e,t)}removeFavoriteBook(e,t){this.favoriteModel.removeBook(e,t),this.setFavorites()}setLibraries(){let e=this.state;e.libraries=this.libraries,this.setStorage(e)}addLibraries(e,t){this.libraryModel.add(e,t),this.setLibraries()}removeLibraries(e){this.libraryModel.remove(e),this.setLibraries()}hasLibrary(e){return this.libraryModel.has(e)}setRegions(){let e=this.state;e.regions=this.regions,this.setStorage(e)}addRegion(e){this.regionModel.add(e),this.setRegions()}removeRegion(e){this.regionModel.remove(e),this.setRegions()}addDetailRegion(e,t,i){this.regionModel.addDetail(e,t,i),this.setRegions()}removeDetailRegion(e,t){this.regionModel.removeDetail(e,t),this.setRegions()}subscribeToBookStateUpdate(e){this.bookStateUpdatePublisher.subscribe(e)}unsubscribeToBookStateUpdate(e){this.bookStateUpdatePublisher.unsubscribe(e)}subscribeFavoriteCategoriesUpdate(e){this.favoriteModel.subscribeCategoriesUpdate(e)}unsubscribeFavoriteCategoriesUpdate(e){this.favoriteModel.unsubscribeCategoriesUpdate(e)}subscribeFavoriteBookUpdate(e){this.favoriteModel.subscribeBookUpdate(e)}unsubscribeFavoriteBookUpdate(e){this.favoriteModel.unsubscribeBookUpdate(e)}subscribeLibraryUpdate(e){this.libraryModel.subscribeUpdate(e)}unsubscribeLibraryUpdate(e){this.libraryModel.unsubscribeUpdate(e)}subscribeRegionUpdate(e){this.regionModel.subscribeUpdatePublisher(e)}unsubscribeRegionUpdate(e){this.regionModel.unsubscribeUpdatePublisher(e)}subscribeDetailRegionUpdate(e){this.regionModel.subscribeDetailUpdatePublisher(e)}unsubscribeDetailRegionUpdate(e){this.regionModel.unsubscribeDetailUpdatePublisher(e)}},le=new N,f=le;var _=class extends HTMLElement{constructor(){super();this.createCategoryItem=t=>{if(!this.container)return;let i=document.createElement("label"),o=this.createCheckbox(t),a=document.createElement("span");return a.textContent=t,i.appendChild(o),i.appendChild(a),i};this.isbn=this.getISBN(),this.button=null,this.container=null,this.onClickCategory=this.onClickCategory.bind(this),this.handleCategoryUpdate=this.handleCategoryUpdate.bind(this)}connectedCallback(){var t;this.button=this.createButton(),this.container=this.createContainer(),this.render(),(t=this.button)==null||t.addEventListener("click",this.onClickCategory),f.subscribeFavoriteCategoriesUpdate(this.handleCategoryUpdate)}render(){!this.container||!this.button||(f.sortedFavoriteKeys.map(t=>this.createCategoryItem(t)).forEach(t=>{var i;return(i=this.container)==null?void 0:i.appendChild(t)}),this.appendChild(this.container),this.appendChild(this.button))}createButton(){let t=document.createElement("button");return t.className="category-button",t.textContent="Category",t}createContainer(){let t=document.createElement("div");return t.className="category",t.hidden=!0,t}onClickCategory(){let t=this.querySelector(".category");t.hidden=!t.hidden}getISBN(){let t=this.closest("[data-isbn]");return t&&t.dataset.isbn?t.dataset.isbn:null}createCheckbox(t){let i=this.isbn||"",o=document.createElement("input");return o.type="checkbox",f.hasFavoriteBook(t,i)&&(o.checked=!0),o.addEventListener("change",()=>this.onChange(o,t)),o}onChange(t,i){let o=this.isbn||"",a=f.hasFavoriteBook(i,o);a?f.removeFavoriteBook(i,o):f.addFavoriteBook(i,o),t.checked=!a}handleCategoryUpdate({type:t,payload:i}){let o={add:()=>this.handleAdd(i.name),rename:()=>this.reanmeCategory(i.newName),change:()=>this.changeCategory(i.targetIndex,i.draggedIndex),delete:()=>this.handleDelete(i.name)};o[t]?o[t]():console.error("no type")}handleAdd(t){var i;(i=this.container)==null||i.appendChild(this.createCategoryItem(t))}handleDelete(t){this.querySelectorAll("label span").forEach((i,o)=>{i.textContent===t&&this.querySelectorAll("label")[o].remove()})}changeCategory(t,i){var d,b;let o=this.querySelectorAll("label"),a=this.createCategoryItem((d=o[i].querySelector("span"))==null?void 0:d.textContent),l=this.createCategoryItem((b=o[t].querySelector("span"))==null?void 0:b.textContent);o[t].replaceWith(a),o[i].replaceWith(l)}reanmeCategory(t){let i=this.querySelectorAll("label")[f.sortedFavoriteKeys.indexOf(t)],o=this.createCategoryItem(t);i.replaceWith(o)}};var z=class{constructor(){this._bus=document.createElement("div")}add(e,t){this._bus.addEventListener(e,t)}remove(e,t){this._bus.removeEventListener(e,t)}dispatch(e,t={}){this._bus.dispatchEvent(new CustomEvent(e,{detail:t}))}},ce=new z;var j=class{constructor(e={}){this.defaultOptions=E({method:"GET",headers:{"Content-Type":"application/json"}},e)}fetch(e,t){return k(this,null,function*(){let i=te(E(E({},this.defaultOptions),t),{timeout:5e3});try{let o=yield fetch(e,i);if(!o.ok)throw new Error(`Http error! status: ${o.status}, message: ${o.statusText}`);return yield o.json()}catch(o){throw console.error(`Error fetching data: ${o}`),new Error(`Error fetching data: ${o}`)}})}},L=new j;(function(){"use strict";if(typeof window!="object")return;if("IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype){"isIntersecting"in window.IntersectionObserverEntry.prototype||Object.defineProperty(window.IntersectionObserverEntry.prototype,"isIntersecting",{get:function(){return this.intersectionRatio>0}});return}function h(r){try{return r.defaultView&&r.defaultView.frameElement||null}catch(s){return null}}var e=function(r){for(var s=r,n=h(s);n;)s=n.ownerDocument,n=h(s);return s}(window.document),t=[],i=null,o=null;function a(r){this.time=r.time,this.target=r.target,this.rootBounds=V(r.rootBounds),this.boundingClientRect=V(r.boundingClientRect),this.intersectionRect=V(r.intersectionRect||x()),this.isIntersecting=!!r.intersectionRect;var s=this.boundingClientRect,n=s.width*s.height,c=this.intersectionRect,u=c.width*c.height;n?this.intersectionRatio=Number((u/n).toFixed(4)):this.intersectionRatio=this.isIntersecting?1:0}function l(r,s){var n=s||{};if(typeof r!="function")throw new Error("callback must be a function");if(n.root&&n.root.nodeType!=1&&n.root.nodeType!=9)throw new Error("root must be a Document or Element");this._checkForIntersections=b(this._checkForIntersections.bind(this),this.THROTTLE_TIMEOUT),this._callback=r,this._observationTargets=[],this._queuedEntries=[],this._rootMarginValues=this._parseRootMargin(n.rootMargin),this.thresholds=this._initThresholds(n.threshold),this.root=n.root||null,this.rootMargin=this._rootMarginValues.map(function(c){return c.value+c.unit}).join(" "),this._monitoringDocuments=[],this._monitoringUnsubscribes=[]}l.prototype.THROTTLE_TIMEOUT=100,l.prototype.POLL_INTERVAL=null,l.prototype.USE_MUTATION_OBSERVER=!0,l._setupCrossOriginUpdater=function(){return i||(i=function(r,s){!r||!s?o=x():o=G(r,s),t.forEach(function(n){n._checkForIntersections()})}),i},l._resetCrossOriginUpdater=function(){i=null,o=null},l.prototype.observe=function(r){var s=this._observationTargets.some(function(n){return n.element==r});if(!s){if(!(r&&r.nodeType==1))throw new Error("target must be an Element");this._registerInstance(),this._observationTargets.push({element:r,entry:null}),this._monitorIntersections(r.ownerDocument),this._checkForIntersections()}},l.prototype.unobserve=function(r){this._observationTargets=this._observationTargets.filter(function(s){return s.element!=r}),this._unmonitorIntersections(r.ownerDocument),this._observationTargets.length==0&&this._unregisterInstance()},l.prototype.disconnect=function(){this._observationTargets=[],this._unmonitorAllIntersections(),this._unregisterInstance()},l.prototype.takeRecords=function(){var r=this._queuedEntries.slice();return this._queuedEntries=[],r},l.prototype._initThresholds=function(r){var s=r||[0];return Array.isArray(s)||(s=[s]),s.sort().filter(function(n,c,u){if(typeof n!="number"||isNaN(n)||n<0||n>1)throw new Error("threshold must be a number between 0 and 1 inclusively");return n!==u[c-1]})},l.prototype._parseRootMargin=function(r){var s=r||"0px",n=s.split(/\s+/).map(function(c){var u=/^(-?\d*\.?\d+)(px|%)$/.exec(c);if(!u)throw new Error("rootMargin must be specified in pixels or percent");return{value:parseFloat(u[1]),unit:u[2]}});return n[1]=n[1]||n[0],n[2]=n[2]||n[0],n[3]=n[3]||n[1],n},l.prototype._monitorIntersections=function(r){var s=r.defaultView;if(s&&this._monitoringDocuments.indexOf(r)==-1){var n=this._checkForIntersections,c=null,u=null;this.POLL_INTERVAL?c=s.setInterval(n,this.POLL_INTERVAL):(T(s,"resize",n,!0),T(r,"scroll",n,!0),this.USE_MUTATION_OBSERVER&&"MutationObserver"in s&&(u=new s.MutationObserver(n),u.observe(r,{attributes:!0,childList:!0,characterData:!0,subtree:!0}))),this._monitoringDocuments.push(r),this._monitoringUnsubscribes.push(function(){var m=r.defaultView;m&&(c&&m.clearInterval(c),I(m,"resize",n,!0)),I(r,"scroll",n,!0),u&&u.disconnect()});var g=this.root&&(this.root.ownerDocument||this.root)||e;if(r!=g){var p=h(r);p&&this._monitorIntersections(p.ownerDocument)}}},l.prototype._unmonitorIntersections=function(r){var s=this._monitoringDocuments.indexOf(r);if(s!=-1){var n=this.root&&(this.root.ownerDocument||this.root)||e,c=this._observationTargets.some(function(p){var m=p.element.ownerDocument;if(m==r)return!0;for(;m&&m!=n;){var y=h(m);if(m=y&&y.ownerDocument,m==r)return!0}return!1});if(!c){var u=this._monitoringUnsubscribes[s];if(this._monitoringDocuments.splice(s,1),this._monitoringUnsubscribes.splice(s,1),u(),r!=n){var g=h(r);g&&this._unmonitorIntersections(g.ownerDocument)}}}},l.prototype._unmonitorAllIntersections=function(){var r=this._monitoringUnsubscribes.slice(0);this._monitoringDocuments.length=0,this._monitoringUnsubscribes.length=0;for(var s=0;s<r.length;s++)r[s]()},l.prototype._checkForIntersections=function(){if(!(!this.root&&i&&!o)){var r=this._rootIsInDom(),s=r?this._getRootRect():x();this._observationTargets.forEach(function(n){var c=n.element,u=D(c),g=this._rootContainsTarget(c),p=n.entry,m=r&&g&&this._computeTargetAndRootIntersection(c,u,s),y=null;this._rootContainsTarget(c)?(!i||this.root)&&(y=s):y=x();var S=n.entry=new a({time:d(),target:c,boundingClientRect:u,rootBounds:y,intersectionRect:m});p?r&&g?this._hasCrossedThreshold(p,S)&&this._queuedEntries.push(S):p&&p.isIntersecting&&this._queuedEntries.push(S):this._queuedEntries.push(S)},this),this._queuedEntries.length&&this._callback(this.takeRecords(),this)}},l.prototype._computeTargetAndRootIntersection=function(r,s,n){if(window.getComputedStyle(r).display!="none"){for(var c=s,u=A(r),g=!1;!g&&u;){var p=null,m=u.nodeType==1?window.getComputedStyle(u):{};if(m.display=="none")return null;if(u==this.root||u.nodeType==9)if(g=!0,u==this.root||u==e)i&&!this.root?!o||o.width==0&&o.height==0?(u=null,p=null,c=null):p=o:p=n;else{var y=A(u),S=y&&D(y),J=y&&this._computeTargetAndRootIntersection(y,S,n);S&&J?(u=y,p=G(S,J)):(u=null,c=null)}else{var Q=u.ownerDocument;u!=Q.body&&u!=Q.documentElement&&m.overflow!="visible"&&(p=D(u))}if(p&&(c=K(p,c)),!c)break;u=u&&A(u)}return c}},l.prototype._getRootRect=function(){var r;if(this.root&&!Y(this.root))r=D(this.root);else{var s=Y(this.root)?this.root:e,n=s.documentElement,c=s.body;r={top:0,left:0,right:n.clientWidth||c.clientWidth,width:n.clientWidth||c.clientWidth,bottom:n.clientHeight||c.clientHeight,height:n.clientHeight||c.clientHeight}}return this._expandRectByRootMargin(r)},l.prototype._expandRectByRootMargin=function(r){var s=this._rootMarginValues.map(function(c,u){return c.unit=="px"?c.value:c.value*(u%2?r.width:r.height)/100}),n={top:r.top-s[0],right:r.right+s[1],bottom:r.bottom+s[2],left:r.left-s[3]};return n.width=n.right-n.left,n.height=n.bottom-n.top,n},l.prototype._hasCrossedThreshold=function(r,s){var n=r&&r.isIntersecting?r.intersectionRatio||0:-1,c=s.isIntersecting?s.intersectionRatio||0:-1;if(n!==c)for(var u=0;u<this.thresholds.length;u++){var g=this.thresholds[u];if(g==n||g==c||g<n!=g<c)return!0}},l.prototype._rootIsInDom=function(){return!this.root||W(e,this.root)},l.prototype._rootContainsTarget=function(r){var s=this.root&&(this.root.ownerDocument||this.root)||e;return W(s,r)&&(!this.root||s==r.ownerDocument)},l.prototype._registerInstance=function(){t.indexOf(this)<0&&t.push(this)},l.prototype._unregisterInstance=function(){var r=t.indexOf(this);r!=-1&&t.splice(r,1)};function d(){return window.performance&&performance.now&&performance.now()}function b(r,s){var n=null;return function(){n||(n=setTimeout(function(){r(),n=null},s))}}function T(r,s,n,c){typeof r.addEventListener=="function"?r.addEventListener(s,n,c||!1):typeof r.attachEvent=="function"&&r.attachEvent("on"+s,n)}function I(r,s,n,c){typeof r.removeEventListener=="function"?r.removeEventListener(s,n,c||!1):typeof r.detachEvent=="function"&&r.detachEvent("on"+s,n)}function K(r,s){var n=Math.max(r.top,s.top),c=Math.min(r.bottom,s.bottom),u=Math.max(r.left,s.left),g=Math.min(r.right,s.right),p=g-u,m=c-n;return p>=0&&m>=0&&{top:n,bottom:c,left:u,right:g,width:p,height:m}||null}function D(r){var s;try{s=r.getBoundingClientRect()}catch(n){}return s?(s.width&&s.height||(s={top:s.top,right:s.right,bottom:s.bottom,left:s.left,width:s.right-s.left,height:s.bottom-s.top}),s):x()}function x(){return{top:0,bottom:0,left:0,right:0,width:0,height:0}}function V(r){return!r||"x"in r?r:{top:r.top,y:r.top,bottom:r.bottom,left:r.left,x:r.left,right:r.right,width:r.width,height:r.height}}function G(r,s){var n=s.top-r.top,c=s.left-r.left;return{top:n,left:c,height:s.height,width:s.width,bottom:n+s.height,right:c+s.width}}function W(r,s){for(var n=s;n;){if(n==r)return!0;n=A(n)}return!1}function A(r){var s=r.parentNode;return r.nodeType==9&&r!=e?h(r):(s&&s.assignedSlot&&(s=s.assignedSlot.parentNode),s&&s.nodeType==11&&s.host?s.host:s)}function Y(r){return r&&r.nodeType===9}window.IntersectionObserver=l,window.IntersectionObserverEntry=a})();var M=class extends HTMLElement{constructor(){super();this.sizeElement=null;this.PATHS=["/search","/favorite","/popular","/library","/setting"],this.sizeElement=null,this.renderBookSize=this.renderBookSize.bind(this)}connectedCallback(){this.render(),this.setSelectedMenu(),this.sizeElement=this.querySelector(".size"),f.subscribeFavoriteBookUpdate(this.renderBookSize),f.subscribeToBookStateUpdate(this.renderBookSize)}disconnectedCallback(){f.unsubscribeFavoriteBookUpdate(this.renderBookSize),f.unsubscribeFavoriteBookUpdate(this.renderBookSize)}get bookSize(){return Object.values(f.favorites).reduce((t,i)=>t+i.length,0)}render(){this.innerHTML=`
            <nav class="gnb">
                <a class="gnb-item" href=".${this.PATHS[0]}">\uCC45 \uAC80\uC0C9</a>
                <a class="gnb-item" href=".${this.PATHS[1]}">\uB098\uC758 \uCC45 (<span class="size">${this.bookSize}</span>)</a>
                <a class="gnb-item" href=".${this.PATHS[2]}">\uC778\uAE30\uB300\uCD9C\uB3C4\uC11C</a>
                <a class="gnb-item" href=".${this.PATHS[3]}">\uB3C4\uC11C\uAD00 \uC870\uD68C</a>
                <a class="gnb-item" href=".${this.PATHS[4]}">\uC124\uC815</a>
            </nav>`}setSelectedMenu(){let t=this.PATHS.indexOf(document.location.pathname);t>=0&&(this.querySelectorAll("a")[t].ariaSelected="true")}renderBookSize(){this.sizeElement&&(this.sizeElement.textContent=this.bookSize.toString())}};var F=class extends HTMLElement{constructor(){super()}show(){this.removeAttribute("hidden")}hide(){this.setAttribute("hidden","")}};customElements.define("loading-component",F);function C(h){let e=h.content.firstElementChild;if(!e)throw new Error("Template content is empty");return e.cloneNode(!0)}function P(h,e){Object.entries(h).forEach(([t,i])=>{let o=e.querySelector(`.${t}`);o.textContent=String(i)})}var H=class extends HTMLElement{constructor(){super();this.loadingElement=null,this.data=null}connectedCallback(){this.loadingElement=this.querySelector(".loading");let t=new URLSearchParams(location.search).get("isbn");this.dataset.isbn=t,this.fetchUsageAnalysisList(t).then(()=>{this.render()})}fetchUsageAnalysisList(t){return k(this,null,function*(){try{let i=yield L.fetch(`/usage-analysis-list?isbn13=${t}`);this.data=i}catch(i){throw this.renderError(),console.error(i),new Error("Fail to get usage analysis list.")}})}render(){var T;if(!this.data){console.error("Data is null");return}let{book:t,keywords:i,coLoanBooks:o,loanHistory:a,loanGrps:l,maniaRecBooks:d,readerRecBooks:b}=this.data;this.renderBook(t),this.renderLoanHistory(a),this.renderLoanGroups(l),this.renderKeyword(i),this.renderRecBooks(".coLoanBooks",o,"#tp-coLoanBookItem"),this.renderRecBooks(".maniaBooks",d,"#tp-recBookItem"),this.renderRecBooks(".readerBooks",b,"#tp-recBookItem"),(T=this.loadingElement)==null||T.remove(),this.loadingElement=null}renderBook(t){let I=t,{bookname:i,bookImageURL:o,description:a}=I,l=re(I,["bookname","bookImageURL","description"]),d=i.split(/[=/:]/).map(K=>`<p>${K}</p>`).join("");this.querySelector(".bookname").innerHTML=d,this.querySelector(".description").innerHTML=a;let b=new w(o,i);this.querySelector(".book-image-container").appendChild(b),P(l,this)}renderLoanHistory(t){let i=new DocumentFragment;t.forEach(o=>{let a=C(this.querySelector("#tp-loanHistoryItem"));P(o,a),i.appendChild(a)}),this.querySelector(".loanHistory tbody").appendChild(i)}renderLoanGroups(t){let i=document.querySelector("#tp-loanGrpItem");if(!i)return;let o=new DocumentFragment;t.forEach(a=>{let l=C(i);P(a,l),o.appendChild(l)}),this.querySelector(".loanGrps tbody").appendChild(o)}renderKeyword(t){let i=t.map(o=>`<a href="/search?keyword=${encodeURI(o.word)}"><span>${o.word}</span></a>`).join("");this.querySelector(".keyword").innerHTML=i}renderRecBooks(t,i,o){let a=this.querySelector(t),l=document.querySelector(o);if(!a||!l){console.error("Container or template not found");return}let d=document.createDocumentFragment();i.map(b=>this.createRecItem(l,b)).forEach(b=>d.appendChild(b)),a.appendChild(d)}createRecItem(t,i){let o=C(t),{isbn13:a}=i;P(i,o);let l=o.querySelector("a");return l&&(l.href=`book?isbn=${a}`),o}renderError(){this.loadingElement&&(this.loadingElement.textContent="\uC815\uBCF4\uB97C \uAC00\uC838\uC62C \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.")}};var O=class extends HTMLElement{constructor(){super()}connectedCallback(){this.fetch(new URLSearchParams(location.search).get("isbn"))}fetch(e){return k(this,null,function*(){let t=Object.values(f.regions);if(t.length===0)return;let i=[];t.forEach(o=>{Object.values(o).forEach(a=>{i.push(this.fetchLibrarySearchByBook(e,a.slice(0,2),a))})}),yield Promise.all(i)})}fetchLibrarySearchByBook(e,t,i){return k(this,null,function*(){let o=new URLSearchParams({isbn:e,region:t,dtl_region:i});try{let a=yield L.fetch(`/library-search-by-book?${o}`);this.render(a,e)}catch(a){throw console.error(a),new Error("Fail to get library search by book.")}})}render({libraries:e},t){if(e.length<1)return;let i=document.createElement("ul"),o=new DocumentFragment;e.map(({homepage:a,libCode:l,libName:d})=>this.createLibrarySearchResultItem(t,a,l,d)).forEach(a=>o.appendChild(a)),i.appendChild(o),document.querySelector(".library-search-by-book").appendChild(i)}createLibrarySearchResultItem(e,t,i,o){let a=document.querySelector("#tp-librarySearchByBookItem");if(!a)return null;let l=C(a),d=l.querySelector("a");return l.dataset.code=i,d.textContent=o,d.href=t,this.loanAvailable(e,i,l),l}loanAvailable(e,t,i){return k(this,null,function*(){let{hasBook:o,loanAvailable:a}=yield this.fetchLoadnAvailabilty(e,t),l=i.querySelector(".hasBook"),d=i.querySelector(".loanAvailable");if(l&&(l.textContent=o==="Y"?"\uC18C\uC7A5":"\uBBF8\uC18C\uC7A5"),d){let b=a==="Y";d.textContent=b?"\uB300\uCD9C \uAC00\uB2A5":"\uB300\uCD9C \uBD88\uAC00",b&&(i.dataset.available="true")}})}fetchLoadnAvailabilty(e,t){return k(this,null,function*(){let o=`/book-exist?${new URLSearchParams({isbn13:e,libCode:t})}`;try{return yield L.fetch(o,{method:"GET",headers:{"Content-Type":"application/json"}})}catch(a){throw console.error(a),new Error("Fail to get book exist.")}})}};customElements.define("nav-gnb",M);customElements.define("app-book",H);customElements.define("library-search-by-book",O);customElements.define("category-selector",_);customElements.define("book-image",w);})();
