"use strict";(()=>{var pe=Object.defineProperty,me=Object.defineProperties;var ge=Object.getOwnPropertyDescriptors;var W=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,he=Object.prototype.propertyIsEnumerable;var ae=(a,e,t)=>e in a?pe(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,v=(a,e)=>{for(var t in e||(e={}))le.call(e,t)&&ae(a,t,e[t]);if(W)for(var t of W(e))he.call(e,t)&&ae(a,t,e[t]);return a},x=(a,e)=>me(a,ge(e));var Y=(a,e)=>{var t={};for(var r in a)le.call(a,r)&&e.indexOf(r)<0&&(t[r]=a[r]);if(a!=null&&W)for(var r of W(a))e.indexOf(r)<0&&he.call(a,r)&&(t[r]=a[r]);return t};var S=(a,e,t)=>new Promise((r,o)=>{var h=d=>{try{f(t.next(d))}catch(T){o(T)}},c=d=>{try{f(t.throw(d))}catch(T){o(T)}},f=d=>d.done?r(d.value):Promise.resolve(d.value).then(h,c);f((t=t.apply(a,e)).next())});var I=class extends HTMLElement{constructor(){super();this.el=null,this.button=null}set data(t){this.render(t)}connectedCallback(){this.render(this.data)}disconnectedCallback(){this.button&&this.button.removeEventListener("click",this.onButtonClick.bind(this))}render(t){let r=`
            <p class="description" data-ellipsis="true">${t}</p>
            <button type="button" class="more-description-button">\uC124\uBA85 \uB354\uBCF4\uAE30</button>`;this.innerHTML=r,this.el=this.querySelector(".description"),this.button=this.querySelector(".more-description-button"),this.button&&this.button.addEventListener("click",this.onButtonClick.bind(this))}onButtonClick(){if(this.el)switch(this.el.dataset.ellipsis){case"true":this.el.dataset.ellipsis="false",this.button&&(this.button.textContent="\uC124\uBA85 \uC811\uAE30");break;case"false":this.el.dataset.ellipsis="true",this.button&&(this.button.textContent="\uC124\uBA85 \uB354\uBCF4\uAE30");break}}};var M=class extends HTMLElement{constructor(t,r){super();this.image=null;this.render(t,r)}render(t,r){let o=document.createElement("img");o.className="thumb",o.src=t,o.alt=r,o.onerror=this.onError.bind(this),this.image=o,this.appendChild(o)}onError(){var t;this.dataset.fail="true",console.error("Failed to load image"),(t=this.image)==null||t.remove()}};var Q="BookWorld";var y=class{constructor(){this.subscribers=[]}subscribe(e){this.subscribers.push(e)}unsubscribe(e){this.subscribers=this.subscribers.filter(t=>t!==e)}notify(e){this.subscribers.forEach(t=>t(e))}};var R=class{constructor(e,t){this.categoriesUpdatePublisher=new y;this.bookUpdatePublisher=new y;this._favorites=e||{},this._sortedKeys=t||[]}get favorites(){return v({},this._favorites)}set favorites(e){this._favorites=e}get sortedKeys(){return[...this._sortedKeys]}set sortedKeys(e){this._sortedKeys=e}add(e){this._favorites[e]=[],this.categoriesUpdatePublisher.notify({type:"add",payload:{name:e}})}addSortedKeys(e){this._sortedKeys.push(e)}rename(e,t){e in this._favorites&&(this._favorites[t]=this._favorites[e],delete this._favorites[e],this.categoriesUpdatePublisher.notify({type:"rename",payload:{prevName:e,newName:t}}))}renameSortedKeys(e,t){let r=this._sortedKeys.indexOf(e);r!==-1&&(this._sortedKeys[r]=t)}change(e,t){let r=this._sortedKeys.indexOf(e),o=this._sortedKeys.indexOf(t);this._sortedKeys[o]=e,this._sortedKeys[r]=t,this.categoriesUpdatePublisher.notify({type:"change",payload:{targetIndex:o,draggedIndex:r}})}delete(e){delete this._favorites[e],this.categoriesUpdatePublisher.notify({type:"delete",payload:{name:e}})}deleteSortedKeys(e){let t=this._sortedKeys.indexOf(e);return this._sortedKeys.splice(t,1),t}has(e){return e in this._favorites}addBook(e,t){e in this._favorites&&this._favorites[e].unshift(t),this.bookUpdatePublisher.notify()}hasBook(e,t){return e in this._favorites&&this._favorites[e].includes(t)}removeBook(e,t){if(e in this._favorites){let r=this._favorites[e].indexOf(t);r!=-1&&this._favorites[e].splice(r,1)}this.bookUpdatePublisher.notify()}subscribeCategoriesUpdate(e){this.categoriesUpdatePublisher.subscribe(e)}unsubscribeCategoriesUpdate(e){this.categoriesUpdatePublisher.unsubscribe(e)}subscribeBookUpdate(e){this.bookUpdatePublisher.subscribe(e)}unsubscribeBookUpdate(e){this.bookUpdatePublisher.unsubscribe(e)}};var O=class{constructor(e){this.publisher=new y;this._libraries=e}get libraries(){return v({},this._libraries)}set libraries(e){this._libraries=e}add(e,t){this._libraries[e]=t,this.publisher.notify({type:"add",payload:{code:e,name:t}})}remove(e){delete this._libraries[e],this.publisher.notify({type:"delete",payload:{code:e}})}has(e){return e in this._libraries}subscribeUpdate(e){this.publisher.subscribe(e)}unsubscribeUpdate(e){this.publisher.subscribe(e)}};var D=class{constructor(e){this.updatePublisher=new y;this.detailUpdatePublisher=new y;this._regions=e}get regions(){return v({},this._regions)}set regions(e){this._regions=e}add(e){this._regions[e]={},this.updatePublisher.notify()}remove(e){delete this._regions[e],this.updatePublisher.notify()}addDetail(e,t,r){e in this._regions&&(this._regions[e][t]=r),this.detailUpdatePublisher.notify()}removeDetail(e,t){e in this._regions&&t in this._regions[e]&&delete this._regions[e][t],this.detailUpdatePublisher.notify()}subscribeUpdatePublisher(e){this.updatePublisher.subscribe(e)}unsubscribeUpdatePublisher(e){this.updatePublisher.unsubscribe(e)}subscribeDetailUpdatePublisher(e){this.detailUpdatePublisher.subscribe(e)}unsubscribeDetailUpdatePublisher(e){this.detailUpdatePublisher.unsubscribe(e)}};var fe=a=>JSON.parse(JSON.stringify(a)),ce={favorites:{},sortedFavoriteKeys:[],libraries:{},regions:{}},X=class{constructor(){this.bookStateUpdatePublisher=new y;let e=this.loadStorage()||fe(ce),{favorites:t,sortedFavoriteKeys:r,libraries:o,regions:h}=e;this.favoriteModel=new R(t,r),this.libraryModel=new O(o),this.regionModel=new D(h)}loadStorage(){let e=localStorage.getItem(Q);return e?JSON.parse(e):null}setStorage(e){try{localStorage.setItem(Q,JSON.stringify(e))}catch(t){console.error(t)}}get state(){return this.loadStorage()}set state(e){this.setStorage(e);let{favorites:t,sortedFavoriteKeys:r,libraries:o,regions:h}=e;this.favoriteModel.favorites=t,this.favoriteModel.sortedKeys=r,this.libraryModel.libraries=o,this.regionModel.regions=h,this.bookStateUpdatePublisher.notify(),console.log("set state")}get favorites(){return this.favoriteModel.favorites}get sortedFavoriteKeys(){return this.favoriteModel.sortedKeys}get libraries(){return this.libraryModel.libraries}get regions(){return this.regionModel.regions}resetState(){this.state=ce}setFavorites(){let e=this.state;e.favorites=this.favorites,e.sortedFavoriteKeys=this.sortedFavoriteKeys,this.setStorage(e)}addfavorite(e){this.favoriteModel.add(e),this.favoriteModel.addSortedKeys(e),this.setFavorites()}renameFavorite(e,t){this.favoriteModel.rename(e,t),this.setFavorites()}renameSortedFavoriteKey(e,t){this.favoriteModel.renameSortedKeys(e,t),this.setFavorites()}deleteFavorite(e){this.favoriteModel.delete(e),this.setFavorites()}deleteSortedFavoriteKey(e){let t=this.favoriteModel.deleteSortedKeys(e);return this.setFavorites(),t}hasFavorite(e){return this.favoriteModel.has(e)}changeFavorite(e,t){this.favoriteModel.change(e,t),this.setFavorites()}addFavoriteBook(e,t){this.favoriteModel.addBook(e,t),this.setFavorites()}hasFavoriteBook(e,t){return this.favoriteModel.hasBook(e,t)}removeFavoriteBook(e,t){this.favoriteModel.removeBook(e,t),this.setFavorites()}setLibraries(){let e=this.state;e.libraries=this.libraries,this.setStorage(e)}addLibraries(e,t){this.libraryModel.add(e,t),this.setLibraries()}removeLibraries(e){this.libraryModel.remove(e),this.setLibraries()}hasLibrary(e){return this.libraryModel.has(e)}setRegions(){let e=this.state;e.regions=this.regions,this.setStorage(e)}addRegion(e){this.regionModel.add(e),this.setRegions()}removeRegion(e){this.regionModel.remove(e),this.setRegions()}addDetailRegion(e,t,r){this.regionModel.addDetail(e,t,r),this.setRegions()}removeDetailRegion(e,t){this.regionModel.removeDetail(e,t),this.setRegions()}subscribeToBookStateUpdate(e){this.bookStateUpdatePublisher.subscribe(e)}unsubscribeToBookStateUpdate(e){this.bookStateUpdatePublisher.unsubscribe(e)}subscribeFavoriteCategoriesUpdate(e){this.favoriteModel.subscribeCategoriesUpdate(e)}unsubscribeFavoriteCategoriesUpdate(e){this.favoriteModel.unsubscribeCategoriesUpdate(e)}subscribeFavoriteBookUpdate(e){this.favoriteModel.subscribeBookUpdate(e)}unsubscribeFavoriteBookUpdate(e){this.favoriteModel.unsubscribeBookUpdate(e)}subscribeLibraryUpdate(e){this.libraryModel.subscribeUpdate(e)}unsubscribeLibraryUpdate(e){this.libraryModel.unsubscribeUpdate(e)}subscribeRegionUpdate(e){this.regionModel.subscribeUpdatePublisher(e)}unsubscribeRegionUpdate(e){this.regionModel.unsubscribeUpdatePublisher(e)}subscribeDetailRegionUpdate(e){this.regionModel.subscribeDetailUpdatePublisher(e)}unsubscribeDetailRegionUpdate(e){this.regionModel.unsubscribeDetailUpdatePublisher(e)}},ve=new X,g=ve;var B=class extends HTMLElement{constructor(){super();this.createCategoryItem=t=>{if(!this.container)return;let r=document.createElement("label"),o=this.createCheckbox(t),h=document.createElement("span");return h.textContent=t,r.appendChild(o),r.appendChild(h),r};this.isbn=this.getISBN(),this.button=null,this.container=null,this.onClickCategory=this.onClickCategory.bind(this),this.handleCategoryUpdate=this.handleCategoryUpdate.bind(this)}connectedCallback(){var t;this.button=this.createButton(),this.container=this.createContainer(),this.render(),(t=this.button)==null||t.addEventListener("click",this.onClickCategory),g.subscribeFavoriteCategoriesUpdate(this.handleCategoryUpdate)}render(){!this.container||!this.button||(g.sortedFavoriteKeys.map(t=>this.createCategoryItem(t)).forEach(t=>{var r;return(r=this.container)==null?void 0:r.appendChild(t)}),this.appendChild(this.container),this.appendChild(this.button))}createButton(){let t=document.createElement("button");return t.className="category-button",t.textContent="Category",t}createContainer(){let t=document.createElement("div");return t.className="category",t.hidden=!0,t}onClickCategory(){let t=this.querySelector(".category");t.hidden=!t.hidden}getISBN(){let t=this.closest("[data-isbn]");return t&&t.dataset.isbn?t.dataset.isbn:null}createCheckbox(t){let r=this.isbn||"",o=document.createElement("input");return o.type="checkbox",g.hasFavoriteBook(t,r)&&(o.checked=!0),o.addEventListener("change",()=>this.onChange(o,t)),o}onChange(t,r){let o=this.isbn||"",h=g.hasFavoriteBook(r,o);h?g.removeFavoriteBook(r,o):g.addFavoriteBook(r,o),t.checked=!h}handleCategoryUpdate({type:t,payload:r}){let o={add:()=>this.handleAdd(r.name),rename:()=>this.reanmeCategory(r.newName),change:()=>this.changeCategory(r.targetIndex,r.draggedIndex),delete:()=>this.handleDelete(r.name)};o[t]?o[t]():console.error("no type")}handleAdd(t){var r;(r=this.container)==null||r.appendChild(this.createCategoryItem(t))}handleDelete(t){this.querySelectorAll("label span").forEach((r,o)=>{r.textContent===t&&this.querySelectorAll("label")[o].remove()})}changeCategory(t,r){var f,d;let o=this.querySelectorAll("label"),h=this.createCategoryItem((f=o[r].querySelector("span"))==null?void 0:f.textContent),c=this.createCategoryItem((d=o[t].querySelector("span"))==null?void 0:d.textContent);o[t].replaceWith(h),o[r].replaceWith(c)}reanmeCategory(t){let r=this.querySelectorAll("label")[g.sortedFavoriteKeys.indexOf(t)],o=this.createCategoryItem(t);r.replaceWith(o)}};var Z=class{constructor(){this._bus=document.createElement("div")}add(e,t){this._bus.addEventListener(e,t)}remove(e,t){this._bus.removeEventListener(e,t)}dispatch(e,t={}){this._bus.dispatchEvent(new CustomEvent(e,{detail:t}))}},ye=new Z;var ee=class{constructor(e={}){this.defaultOptions=v({method:"GET",headers:{"Content-Type":"application/json"}},e)}fetch(e,t){return S(this,null,function*(){let r=x(v(v({},this.defaultOptions),t),{timeout:5e3});try{let o=yield fetch(e,r);if(!o.ok)throw new Error(`Http error! status: ${o.status}, message: ${o.statusText}`);return yield o.json()}catch(o){throw console.error(`Error fetching data: ${o}`),new Error(`Error fetching data: ${o}`)}})}},C=new ee;(function(){"use strict";if(typeof window!="object")return;if("IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype){"isIntersecting"in window.IntersectionObserverEntry.prototype||Object.defineProperty(window.IntersectionObserverEntry.prototype,"isIntersecting",{get:function(){return this.intersectionRatio>0}});return}function a(i){try{return i.defaultView&&i.defaultView.frameElement||null}catch(s){return null}}var e=function(i){for(var s=i,n=a(s);n;)s=n.ownerDocument,n=a(s);return s}(window.document),t=[],r=null,o=null;function h(i){this.time=i.time,this.target=i.target,this.rootBounds=J(i.rootBounds),this.boundingClientRect=J(i.boundingClientRect),this.intersectionRect=J(i.intersectionRect||w()),this.isIntersecting=!!i.intersectionRect;var s=this.boundingClientRect,n=s.width*s.height,l=this.intersectionRect,u=l.width*l.height;n?this.intersectionRatio=Number((u/n).toFixed(4)):this.intersectionRatio=this.isIntersecting?1:0}function c(i,s){var n=s||{};if(typeof i!="function")throw new Error("callback must be a function");if(n.root&&n.root.nodeType!=1&&n.root.nodeType!=9)throw new Error("root must be a Document or Element");this._checkForIntersections=d(this._checkForIntersections.bind(this),this.THROTTLE_TIMEOUT),this._callback=i,this._observationTargets=[],this._queuedEntries=[],this._rootMarginValues=this._parseRootMargin(n.rootMargin),this.thresholds=this._initThresholds(n.threshold),this.root=n.root||null,this.rootMargin=this._rootMarginValues.map(function(l){return l.value+l.unit}).join(" "),this._monitoringDocuments=[],this._monitoringUnsubscribes=[]}c.prototype.THROTTLE_TIMEOUT=100,c.prototype.POLL_INTERVAL=null,c.prototype.USE_MUTATION_OBSERVER=!0,c._setupCrossOriginUpdater=function(){return r||(r=function(i,s){!i||!s?o=w():o=re(i,s),t.forEach(function(n){n._checkForIntersections()})}),r},c._resetCrossOriginUpdater=function(){r=null,o=null},c.prototype.observe=function(i){var s=this._observationTargets.some(function(n){return n.element==i});if(!s){if(!(i&&i.nodeType==1))throw new Error("target must be an Element");this._registerInstance(),this._observationTargets.push({element:i,entry:null}),this._monitorIntersections(i.ownerDocument),this._checkForIntersections()}},c.prototype.unobserve=function(i){this._observationTargets=this._observationTargets.filter(function(s){return s.element!=i}),this._unmonitorIntersections(i.ownerDocument),this._observationTargets.length==0&&this._unregisterInstance()},c.prototype.disconnect=function(){this._observationTargets=[],this._unmonitorAllIntersections(),this._unregisterInstance()},c.prototype.takeRecords=function(){var i=this._queuedEntries.slice();return this._queuedEntries=[],i},c.prototype._initThresholds=function(i){var s=i||[0];return Array.isArray(s)||(s=[s]),s.sort().filter(function(n,l,u){if(typeof n!="number"||isNaN(n)||n<0||n>1)throw new Error("threshold must be a number between 0 and 1 inclusively");return n!==u[l-1]})},c.prototype._parseRootMargin=function(i){var s=i||"0px",n=s.split(/\s+/).map(function(l){var u=/^(-?\d*\.?\d+)(px|%)$/.exec(l);if(!u)throw new Error("rootMargin must be specified in pixels or percent");return{value:parseFloat(u[1]),unit:u[2]}});return n[1]=n[1]||n[0],n[2]=n[2]||n[0],n[3]=n[3]||n[1],n},c.prototype._monitorIntersections=function(i){var s=i.defaultView;if(s&&this._monitoringDocuments.indexOf(i)==-1){var n=this._checkForIntersections,l=null,u=null;this.POLL_INTERVAL?l=s.setInterval(n,this.POLL_INTERVAL):(T(s,"resize",n,!0),T(i,"scroll",n,!0),this.USE_MUTATION_OBSERVER&&"MutationObserver"in s&&(u=new s.MutationObserver(n),u.observe(i,{attributes:!0,childList:!0,characterData:!0,subtree:!0}))),this._monitoringDocuments.push(i),this._monitoringUnsubscribes.push(function(){var m=i.defaultView;m&&(l&&m.clearInterval(l),z(m,"resize",n,!0)),z(i,"scroll",n,!0),u&&u.disconnect()});var p=this.root&&(this.root.ownerDocument||this.root)||e;if(i!=p){var b=a(i);b&&this._monitorIntersections(b.ownerDocument)}}},c.prototype._unmonitorIntersections=function(i){var s=this._monitoringDocuments.indexOf(i);if(s!=-1){var n=this.root&&(this.root.ownerDocument||this.root)||e,l=this._observationTargets.some(function(b){var m=b.element.ownerDocument;if(m==i)return!0;for(;m&&m!=n;){var E=a(m);if(m=E&&E.ownerDocument,m==i)return!0}return!1});if(!l){var u=this._monitoringUnsubscribes[s];if(this._monitoringDocuments.splice(s,1),this._monitoringUnsubscribes.splice(s,1),u(),i!=n){var p=a(i);p&&this._unmonitorIntersections(p.ownerDocument)}}}},c.prototype._unmonitorAllIntersections=function(){var i=this._monitoringUnsubscribes.slice(0);this._monitoringDocuments.length=0,this._monitoringUnsubscribes.length=0;for(var s=0;s<i.length;s++)i[s]()},c.prototype._checkForIntersections=function(){if(!(!this.root&&r&&!o)){var i=this._rootIsInDom(),s=i?this._getRootRect():w();this._observationTargets.forEach(function(n){var l=n.element,u=k(l),p=this._rootContainsTarget(l),b=n.entry,m=i&&p&&this._computeTargetAndRootIntersection(l,u,s),E=null;this._rootContainsTarget(l)?(!r||this.root)&&(E=s):E=w();var L=n.entry=new h({time:f(),target:l,boundingClientRect:u,rootBounds:E,intersectionRect:m});b?i&&p?this._hasCrossedThreshold(b,L)&&this._queuedEntries.push(L):b&&b.isIntersecting&&this._queuedEntries.push(L):this._queuedEntries.push(L)},this),this._queuedEntries.length&&this._callback(this.takeRecords(),this)}},c.prototype._computeTargetAndRootIntersection=function(i,s,n){if(window.getComputedStyle(i).display!="none"){for(var l=s,u=j(i),p=!1;!p&&u;){var b=null,m=u.nodeType==1?window.getComputedStyle(u):{};if(m.display=="none")return null;if(u==this.root||u.nodeType==9)if(p=!0,u==this.root||u==e)r&&!this.root?!o||o.width==0&&o.height==0?(u=null,b=null,l=null):b=o:b=n;else{var E=j(u),L=E&&k(E),oe=E&&this._computeTargetAndRootIntersection(E,L,n);L&&oe?(u=E,b=re(L,oe)):(u=null,l=null)}else{var ne=u.ownerDocument;u!=ne.body&&u!=ne.documentElement&&m.overflow!="visible"&&(b=k(u))}if(b&&(l=N(b,l)),!l)break;u=u&&j(u)}return l}},c.prototype._getRootRect=function(){var i;if(this.root&&!se(this.root))i=k(this.root);else{var s=se(this.root)?this.root:e,n=s.documentElement,l=s.body;i={top:0,left:0,right:n.clientWidth||l.clientWidth,width:n.clientWidth||l.clientWidth,bottom:n.clientHeight||l.clientHeight,height:n.clientHeight||l.clientHeight}}return this._expandRectByRootMargin(i)},c.prototype._expandRectByRootMargin=function(i){var s=this._rootMarginValues.map(function(l,u){return l.unit=="px"?l.value:l.value*(u%2?i.width:i.height)/100}),n={top:i.top-s[0],right:i.right+s[1],bottom:i.bottom+s[2],left:i.left-s[3]};return n.width=n.right-n.left,n.height=n.bottom-n.top,n},c.prototype._hasCrossedThreshold=function(i,s){var n=i&&i.isIntersecting?i.intersectionRatio||0:-1,l=s.isIntersecting?s.intersectionRatio||0:-1;if(n!==l)for(var u=0;u<this.thresholds.length;u++){var p=this.thresholds[u];if(p==n||p==l||p<n!=p<l)return!0}},c.prototype._rootIsInDom=function(){return!this.root||ie(e,this.root)},c.prototype._rootContainsTarget=function(i){var s=this.root&&(this.root.ownerDocument||this.root)||e;return ie(s,i)&&(!this.root||s==i.ownerDocument)},c.prototype._registerInstance=function(){t.indexOf(this)<0&&t.push(this)},c.prototype._unregisterInstance=function(){var i=t.indexOf(this);i!=-1&&t.splice(i,1)};function f(){return window.performance&&performance.now&&performance.now()}function d(i,s){var n=null;return function(){n||(n=setTimeout(function(){i(),n=null},s))}}function T(i,s,n,l){typeof i.addEventListener=="function"?i.addEventListener(s,n,l||!1):typeof i.attachEvent=="function"&&i.attachEvent("on"+s,n)}function z(i,s,n,l){typeof i.removeEventListener=="function"?i.removeEventListener(s,n,l||!1):typeof i.detachEvent=="function"&&i.detachEvent("on"+s,n)}function N(i,s){var n=Math.max(i.top,s.top),l=Math.min(i.bottom,s.bottom),u=Math.max(i.left,s.left),p=Math.min(i.right,s.right),b=p-u,m=l-n;return b>=0&&m>=0&&{top:n,bottom:l,left:u,right:p,width:b,height:m}||null}function k(i){var s;try{s=i.getBoundingClientRect()}catch(n){}return s?(s.width&&s.height||(s={top:s.top,right:s.right,bottom:s.bottom,left:s.left,width:s.right-s.left,height:s.bottom-s.top}),s):w()}function w(){return{top:0,bottom:0,left:0,right:0,width:0,height:0}}function J(i){return!i||"x"in i?i:{top:i.top,y:i.top,bottom:i.bottom,left:i.left,x:i.left,right:i.right,width:i.width,height:i.height}}function re(i,s){var n=s.top-i.top,l=s.left-i.left;return{top:n,left:l,height:s.height,width:s.width,bottom:n+s.height,right:l+s.width}}function ie(i,s){for(var n=s;n;){if(n==i)return!0;n=j(n)}return!1}function j(i){var s=i.parentNode;return i.nodeType==9&&i!=e?a(i):(s&&s.assignedSlot&&(s=s.assignedSlot.parentNode),s&&s.nodeType==11&&s.host?s.host:s)}function se(i){return i&&i.nodeType===9}window.IntersectionObserver=c,window.IntersectionObserverEntry=h})();var P=class{constructor(e,t){this.target=e,this.observer=new IntersectionObserver(r=>{this.handleIntersection(r,t)})}observe(){this.observer.observe(this.target)}unobserve(){this.observer.unobserve(this.target)}disconnect(){this.observer.disconnect()}handleIntersection(e,t){e.forEach(r=>{r.isIntersecting&&(this.unobserve(),t())})}};var U=class extends HTMLElement{constructor(){super();this.container=this.querySelector(".library-list"),this.itemTemplate=""}connectedCallback(){this.itemTemplate=this.template()}onLibraryBookExist(t,r,o){return S(this,null,function*(){let h=Object.entries(o);this.loading(h.length),t&&(t.disabled=!0);let c=h.map((z,N)=>S(this,[z,N],function*([f,d],T){try{let k=yield C.fetch(`/book-exist?isbn13=${r}&libCode=${f}`);this.renderBookExist(k,d,T)}catch(k){throw console.error(k),new Error("Fail to get usage analysis list.")}}));try{yield Promise.all(c),this.removeLoading()}catch(f){console.error("Failed to fetch data for some libraries")}})}renderBookExist(t,r,o){let{hasBook:h,loanAvailable:c}=t,f=h==="Y"?c==="Y"?"| \uB300\uCD9C\uAC00\uB2A5":"| \uB300\uCD9C\uBD88\uAC00":"",d=this.querySelectorAll(".library-item")[o];d.querySelector(".name").textContent=`\u2219 ${r} : `,d.querySelector(".hasBook").textContent=h==="Y"?"\uC18C\uC7A5":"\uBBF8\uC18C\uC7A5",d.querySelector(".loanAvailable").textContent=f}loading(t){let r="";for(;t>0;)r+=this.itemTemplate,t--;this.container.innerHTML=r}removeLoading(){this.querySelectorAll(".library-item[data-loading=true]").forEach(t=>{delete t.dataset.loading})}template(){return`<li class="library-item" data-loading="true">
            <span class="name"></span>
            <span class="hasBook"></span>
            <span class="loanAvailable"></span>
        </li>`}};var H=class extends HTMLElement{constructor(){super();this.sizeElement=null;this.PATHS=["/search","/favorite","/popular","/library","/setting"],this.sizeElement=null,this.renderBookSize=this.renderBookSize.bind(this)}connectedCallback(){this.render(),this.setSelectedMenu(),this.sizeElement=this.querySelector(".size"),g.subscribeFavoriteBookUpdate(this.renderBookSize),g.subscribeToBookStateUpdate(this.renderBookSize)}disconnectedCallback(){g.unsubscribeFavoriteBookUpdate(this.renderBookSize),g.unsubscribeFavoriteBookUpdate(this.renderBookSize)}get bookSize(){return Object.values(g.favorites).reduce((t,r)=>t+r.length,0)}render(){this.innerHTML=`
            <nav class="gnb">
                <a class="gnb-item" href=".${this.PATHS[0]}">\uCC45 \uAC80\uC0C9</a>
                <a class="gnb-item" href=".${this.PATHS[1]}">\uB098\uC758 \uCC45 (<span class="size">${this.bookSize}</span>)</a>
                <a class="gnb-item" href=".${this.PATHS[2]}">\uC778\uAE30\uB300\uCD9C\uB3C4\uC11C</a>
                <a class="gnb-item" href=".${this.PATHS[3]}">\uB3C4\uC11C\uAD00 \uC870\uD68C</a>
                <a class="gnb-item" href=".${this.PATHS[4]}">\uC124\uC815</a>
            </nav>`}setSelectedMenu(){let t=this.PATHS.indexOf(document.location.pathname);t>=0&&(this.querySelectorAll("a")[t].ariaSelected="true")}renderBookSize(){this.sizeElement&&(this.sizeElement.textContent=this.bookSize.toString())}};var q=class extends HTMLElement{constructor(){super()}show(){this.removeAttribute("hidden")}hide(){this.setAttribute("hidden","")}};customElements.define("loading-component",q);var F=document.querySelector("book-list"),ue=document.querySelector("input-search form"),G=document.querySelector("input-search input[type='search']");var A=class extends HTMLElement{constructor(){super();this.boundPopStateHandler=null}connectedCallback(){this.renderBookList(),this.boundPopStateHandler=this.onPopState.bind(this),window.addEventListener("popstate",this.boundPopStateHandler)}disconnectedCallback(){this.boundPopStateHandler&&window.removeEventListener("popstate",this.boundPopStateHandler)}onPopState(){this.renderBookList()}renderBookList(){var h;let t=new URLSearchParams(location.search),r=t.get("keyword"),o=t.get("sort")||"sim";r&&o&&((h=F)==null||h.initializeSearchPage(r,o),G.value=r)}};var K=class extends HTMLElement{constructor(){super();this.handleRadioChange=()=>{this.form.dispatchEvent(new Event("submit"))};this.onSubmit=t=>{var c;if(t.preventDefault(),!this.input)return;this.input.focus();let r=new URL(window.location.href),o=this.input.value,h=this.form.sort.value;r.searchParams.set("keyword",o),r.searchParams.set("sort",h),window.history.pushState({},"",r.toString()),(c=F)==null||c.initializeSearchPage(o,h)};this.form=this.querySelector("form"),this.input=this.querySelector("input[type='search']")}connectedCallback(){this.form.addEventListener("submit",this.onSubmit),this.form.sort.forEach(t=>{t.addEventListener("change",this.handleRadioChange)})}disconnectedCallback(){this.form.removeEventListener("submit",this.onSubmit),this.form.sort.forEach(t=>{t.removeEventListener("change",this.handleRadioChange)})}};function de(a,e){Object.entries(a).forEach(([t,r])=>{let o=e.querySelector(`.${t}`);o.textContent=String(r)})}function te(a,e){let w=e,{description:t,image:r,isbn:o,link:h,title:c}=w,f=Y(w,["description","image","isbn","link","title"]),d=a.querySelector(".book-summary a"),T=new M(r,c);d.appendChild(T);let z=a.querySelector(".link");z.href=h;let N=a.querySelector("book-description");N&&(N.data=t);let k=a.querySelector("a");k.href=`/book?isbn=${o}`,de(x(v({},f),{title:c}),a),a.dataset.isbn=o}var _=class extends HTMLElement{constructor(t){super();this.libraryButton=null;this.libraryBookExist=null;this.data=t,this.onLibraryButtonClick=this.onLibraryButtonClick.bind(this)}connectedCallback(){this.renderView(),this.libraryButton=this.querySelector(".library-button"),this.libraryBookExist=this.querySelector("library-book-exist"),this.libraryButton.addEventListener("click",this.onLibraryButtonClick)}disconnectedCallback(){var t;(t=this.libraryButton)==null||t.removeEventListener("click",this.onLibraryButtonClick)}renderView(){let c=this.data,{discount:t,pubdate:r}=c,o=Y(c,["discount","pubdate"]),h=x(v({},o),{discount:Number(t).toLocaleString(),pubdate:this.getPubdate(r)});te(this,h)}getPubdate(t){return`${t.substring(0,4)}.${t.substring(4,6)}.${t.substring(6)}`}onLibraryButtonClick(){var t;(t=this.libraryBookExist)==null||t.onLibraryBookExist(this.libraryButton,this.dataset.isbn||"",g.libraries)}};var be={search:"/search-naver-book"};var $=class extends HTMLElement{constructor(){super();this.paginationElement=this.querySelector(".paging-info"),this.bookContainer=this.querySelector(".books"),this.loadingComponent=this.querySelector("loading-component"),this.observeTarget=this.querySelector(".observe"),this.itemTemplate=document.querySelector("#tp-book-item"),this.itemsPerPage=10,this.fetchBooks=this.fetchBooks.bind(this),this.initializeSearchPage=this.initializeSearchPage.bind(this)}connectedCallback(){this.observer=new P(this.observeTarget,this.fetchBooks)}disconnectedCallback(){var t;(t=this.observer)==null||t.disconnect()}initializeSearchPage(t,r){var o;this.keyword=t,this.sortingOrder=r,this.currentItemCount=0,(o=this.observer)==null||o.disconnect(),this.keyword?this.loadBooks():this.showDefaultMessage()}loadBooks(){var t,r;this.bookContainer.innerHTML="",(t=this.loadingComponent)==null||t.show(),this.fetchBooks(),(r=this.loadingComponent)==null||r.hide()}fetchBooks(){return S(this,null,function*(){if(!this.keyword||!this.sortingOrder)return;let t=`${be.search}?keyword=${encodeURIComponent(this.keyword)}&display=${this.itemsPerPage}&start=${this.currentItemCount+1}&sort=${this.sortingOrder}`;try{let r=yield C.fetch(t);this.render(r)}catch(r){r instanceof Error?console.error(`Error fetching books: ${r.message}`):console.error("An unexpected error occurred")}})}render(t){var r;if(t){if(t.total===0){this.renderMessage("notFound");return}this.currentItemCount+=t.display,this.updatePagingInfo(t.total),this.renderList(t.items),t.total!==this.currentItemCount&&((r=this.observer)==null||r.observe())}}updatePagingInfo(t){let r={keyword:`${this.keyword}`,length:`${this.currentItemCount.toLocaleString()}`,total:`${t.toLocaleString()}`,display:`${this.itemsPerPage}\uAC1C\uC529`};for(let[o,h]of Object.entries(r)){let c=this.paginationElement.querySelector(`.__${o}`);c.textContent=h}this.paginationElement.hidden=!1}renderList(t){let r=new DocumentFragment;t.map((o,h)=>this.createItem(o,h)).forEach(o=>r.appendChild(o)),this.bookContainer.appendChild(r)}createItem(t,r){let o=new _(t);return o.dataset.index=this.getIndex(r).toString(),o.appendChild(this.itemTemplate.content.cloneNode(!0)),o}getIndex(t){return Math.ceil((this.currentItemCount-this.itemsPerPage)/this.itemsPerPage)*this.itemsPerPage+t}showDefaultMessage(){this.paginationElement.hidden=!0,this.renderMessage("message")}renderMessage(t){let r=document.querySelector(`#tp-${t}`);r&&(this.bookContainer.innerHTML="",this.bookContainer.appendChild(r.content.cloneNode(!0)))}};var V=class extends HTMLElement{constructor(){super()}connectedCallback(){this.fetch()}fetch(){return S(this,null,function*(){let e=new Date;e.setMonth(e.getMonth()-1);let t=e.getMonth()+1,r=t<10?`0${t}`:t.toString(),o=new URLSearchParams({month:`${e.getFullYear()}-${r}`});try{let h=yield C.fetch(`/monthly-keywords?${o}`);this.render(h.keywords)}catch(h){throw console.error(h),new Error("Fail to get monthly keyword.")}})}render(e){let t=new DocumentFragment;e.map(r=>{let o=document.createElement("a");return o.textContent=r.word,o.href=`?keyword=${r.word}`,o.addEventListener("click",h=>this.onKeywordClick(h,r.word)),o}).forEach(r=>t.appendChild(r)),this.appendChild(t)}onKeywordClick(e,t){var h,c;e.preventDefault();let r=new URL(window.location.href),o=(h=ue)==null?void 0:h.sort.value;r.searchParams.set("keyword",t),r.searchParams.set("sort",o),window.history.pushState({},"",r.toString()),G.value=t,(c=F)==null||c.initializeSearchPage(t,o)}};customElements.define("book-image",M);customElements.define("nav-gnb",H);customElements.define("book-list",$);customElements.define("app-search",A);customElements.define("input-search",K);customElements.define("book-item",_);customElements.define("book-description",I);customElements.define("library-book-exist",U);customElements.define("category-selector",B);customElements.define("monthly-keywords",V);})();
