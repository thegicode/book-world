"use strict";(()=>{var m=class extends HTMLElement{constructor(){super(),this.el=null,this.button=null}set data(t){this.render(t)}connectedCallback(){this.render(this.data)}disconnectedCallback(){this.button&&this.button.removeEventListener("click",this.onClickButton.bind(this))}render(t){let e=`
            <p class="description" data-ellipsis="true">${t}</p>
            <button type="button" class="more-description-button">\uC124\uBA85 \uB354\uBCF4\uAE30</button>`;this.innerHTML=e,this.el=this.querySelector(".description"),this.button=this.querySelector(".more-description-button"),this.button&&this.button.addEventListener("click",this.onClickButton.bind(this))}onClickButton(){if(this.el)switch(this.el.dataset.ellipsis){case"true":this.el.dataset.ellipsis="false",this.button&&(this.button.textContent="\uC124\uBA85 \uC811\uAE30");break;case"false":this.el.dataset.ellipsis="true",this.button&&(this.button.textContent="\uC124\uBA85 \uB354\uBCF4\uAE30");break;default:console.log("\uC124\uBA85 \uB354\uBCF4\uAE30 \uBC84\uD2BC \uC2E4\uD589")}}};var C=class{constructor(){this._bus=document.createElement("div")}add(t,e){this._bus.addEventListener(t,e)}remove(t,e){this._bus.removeEventListener(t,e)}dispatch(t,e={}){this._bus.dispatchEvent(new CustomEvent(t,{detail:e}))}},u=new C;var z=function(i,t,e,o){function n(s){return s instanceof e?s:new e(function(r){r(s)})}return new(e||(e=Promise))(function(s,r){function h(a){try{c(o.next(a))}catch(l){r(l)}}function d(a){try{c(o.throw(a))}catch(l){r(l)}}function c(a){a.done?s(a.value):n(a.value).then(h,d)}c((o=o.apply(i,t||[])).next())})},L=class{constructor(t={}){this.defaultOptions=Object.assign({method:"GET",headers:{"Content-Type":"application/json"}},t)}fetch(t,e){return z(this,void 0,void 0,function*(){let o=Object.assign(Object.assign(Object.assign({},this.defaultOptions),e),{timeout:5e3});try{let n=yield fetch(t,o);if(!n.ok)throw new Error(`Http error! status: ${n.status}, message: ${n.statusText}`);return yield n.json()}catch(n){throw console.error(`Error fetching data: ${n}`),new Error(`Error fetching data: ${n}`)}})}},y=new L;var f=class{constructor(t,e){this.target=t,this.observer=new IntersectionObserver(o=>{this.handleIntersection(o,e)})}observe(){this.observer.observe(this.target)}unobserve(){this.observer.unobserve(this.target)}disconnect(){this.observer.disconnect()}handleIntersection(t,e){t.forEach(o=>{o.isIntersecting&&(this.unobserve(),e())})}};var H=function(i,t,e,o){function n(s){return s instanceof e?s:new e(function(r){r(s)})}return new(e||(e=Promise))(function(s,r){function h(a){try{c(o.next(a))}catch(l){r(l)}}function d(a){try{c(o.throw(a))}catch(l){r(l)}}function c(a){a.done?s(a.value):n(a.value).then(h,d)}c((o=o.apply(i,t||[])).next())})},p=class extends HTMLElement{constructor(){super(),this.container=this.querySelector(".library-list"),this.itemTemplate=""}connectedCallback(){this.itemTemplate=this.template()}onLibraryBookExist(t,e,o){return H(this,void 0,void 0,function*(){let n=Object.entries(o);this.loading(n.length),t&&(t.disabled=!0);let s=n.map(([r,h],d)=>H(this,void 0,void 0,function*(){try{let c=yield y.fetch(`/book-exist?isbn13=${e}&libCode=${r}`);this.renderBookExist(c,h,d)}catch(c){throw console.error(c),new Error("Fail to get usage analysis list.")}}));try{yield Promise.all(s),this.removeLoading()}catch(r){console.error("Failed to fetch data for some libraries")}})}renderBookExist(t,e,o){let{hasBook:n,loanAvailable:s}=t,r=n==="Y"?"\uC18C\uC7A5, ":"\uBBF8\uC18C\uC7A5",h="";n==="Y"&&(h=s==="Y"?"\uB300\uCD9C\uAC00\uB2A5":"\uB300\uCD9C\uBD88\uAC00");let d=this.querySelectorAll(".library-item")[o],c=d.querySelector(".name");c&&(c.textContent=`\u263C ${e} : `);let a=d.querySelector(".hasBook");a&&(a.textContent=r);let l=d.querySelector(".loanAvailable");l&&(l.textContent=h)}loading(t){let e="";for(;t>0;)e+=this.itemTemplate,t--;this.container.innerHTML=e}removeLoading(){this.querySelectorAll(".library-item[data-loading=true]").forEach(e=>{delete e.dataset.loading})}template(){return`<li class="library-item" data-loading="true">
            <span class="name"></span>
            <span class="hasBook"></span>
            <span class="loanAvailable"></span>
        </li>`}};var R=i=>JSON.parse(JSON.stringify(i)),F={favoriteBooks:[],libraries:{},regions:{}},N="BookWorld",q=i=>{try{localStorage.setItem(N,JSON.stringify(i))}catch(t){console.error(t)}},S=()=>{try{let i=localStorage.getItem(N);return i==null?(q(F),F):R(JSON.parse(i))}catch(i){throw console.error(i),new Error("Failed to get state from localStrage.")}},b=S(),A=i=>{b.favoriteBooks.push(i),q(b)},j=i=>{let t=b.favoriteBooks.indexOf(i);t!==-1&&(b.favoriteBooks.splice(t,1),q(b))},P=i=>b.favoriteBooks.includes(i);var k=class extends HTMLElement{constructor(){super(),this.favoriteBooksSize=this.getFavoriteBooksSize()}connectedCallback(){this.render(),this.setSelectedMenu()}disconnectedCallback(){}getFavoriteBooksSize(){return S().favoriteBooks.length}render(){this.innerHTML=`
            <nav class="gnb">
                <a class="gnb-item" href="./search">\uCC45 \uAC80\uC0C9</a>
                <a class="gnb-item" href="./favorite">\uB098\uC758 \uCC45 (<span class="size">${this.favoriteBooksSize}</span>)</a>
                <a class="gnb-item" href="./library">\uB3C4\uC11C\uAD00 \uC870\uD68C</a>
                <a class="gnb-item" href="./setting">\uC124\uC815</a>
            </nav>`}setSelectedMenu(){let e=["/search","/favorite","/library","/setting"].indexOf(document.location.pathname);e>=0&&(this.querySelectorAll("a")[e].ariaSelected="true")}};var D=(i=S().favoriteBooks.length)=>{let t=document.querySelector("nav-gnb");t.querySelector(".size").textContent=String(i)};var v=class extends HTMLElement{constructor(){super(),this.inputElement=null,this.isbn=null}connectedCallback(){var t;let e=this.closest("[data-isbn]");this.isbn=e.dataset.isbn,this.render(),(t=this.inputElement)===null||t===void 0||t.addEventListener("change",this.onChange.bind(this))}disconnectedCallback(){var t;(t=this.inputElement)===null||t===void 0||t.addEventListener("change",this.onChange)}render(){let t=this.isbn||"",e=P(t)?"checked":"";this.innerHTML=`<label>
            <input type="checkbox" name="favorite" ${e}>
            <span>\uAD00\uC2EC\uCC45</span>
        </label>`,this.inputElement=this.querySelector("input")}onChange(){var t;let e=this.isbn||"";!((t=this.inputElement)===null||t===void 0)&&t.checked?A(e):j(e),D()}};var g=class extends HTMLElement{constructor(){super()}set data(t){this.dataset.object=JSON.stringify(t);let e=this.querySelector("img");e&&e.getAttribute("src")===""&&this.render()}connectedCallback(){this.render()}render(){let t=this.dataset.object?JSON.parse(this.dataset.object):null,e="",o="";if(t){let{bookImageURL:s,bookname:r}=t;e=s,o=r}this.innerHTML=`
            <div class="book-image">
                <img class="thumb" src="${e}" alt="${o}"></img>
            </div>`;let n=this.querySelector("img");n&&n.getAttribute("src")&&this.handleError(n)}handleError(t){t&&(t.onerror=()=>{this.dataset.fail="true",t.remove()})}};var E=class extends HTMLElement{constructor(){super()}connectedCallback(){this.renderBookList(),window.addEventListener("popstate",this.onPopState.bind(this))}disconnectedCallback(){window.removeEventListener("popstate",this.onPopState)}onPopState(){this.renderBookList()}renderBookList(){let e=new URLSearchParams(location.search).get("keyword");u.dispatch("search-page-init",{keyword:e})}};var x=class extends HTMLElement{constructor(){super(),this.form=this.querySelector("form"),this.input=this.querySelector("input")}connectedCallback(){this.form.addEventListener("submit",this.onSubmit.bind(this))}disconnectedCallback(){this.form.removeEventListener("submit",this.onSubmit)}onSubmit(t){t.preventDefault();let e=this.input.value;if(!e)return;this.input.value="";let o=new URL(window.location.href);o.searchParams.set("keyword",e),window.history.pushState({},"",o),u.dispatch("search-page-init",{keyword:e}),this.input.focus()}};var J=function(i,t,e,o){function n(s){return s instanceof e?s:new e(function(r){r(s)})}return new(e||(e=Promise))(function(s,r){function h(a){try{c(o.next(a))}catch(l){r(l)}}function d(a){try{c(o.throw(a))}catch(l){r(l)}}function c(a){a.done?s(a.value):n(a.value).then(h,d)}c((o=o.apply(i,t||[])).next())})},w=class extends HTMLElement{constructor(){super(),this.initializeProperties(),this.bindMethods()}initializeProperties(){this.pagingInfo=this.querySelector(".paging-info"),this.books=this.querySelector(".books")}bindMethods(){this.fetchSearchNaverBook=this.fetchSearchNaverBook.bind(this)}connectedCallback(){this.setupObserver(),u.add("search-page-init",this.onSearchPageInit.bind(this))}disconnectedCallback(){var t;(t=this.observer)===null||t===void 0||t.disconnect(),u.remove("search-page-init",this.onSearchPageInit)}setupObserver(){let t=this.querySelector(".observe"),e=this.fetchSearchNaverBook;this.observer=new f(t,e)}onSearchPageInit(t){let e=t;if(this.keyword=e.detail.keyword,this.length=0,this.keyword){this.handleKeywordPresent();return}this.handleKeywordAbsent()}handleKeywordPresent(){this.showMessage("loading"),this.books.innerHTML="",this.fetchSearchNaverBook()}handleKeywordAbsent(){this.pagingInfo.hidden=!0,this.showMessage("message")}fetchSearchNaverBook(){return J(this,void 0,void 0,function*(){if(!this.keyword)return;let t=`/search-naver-book?keyword=${encodeURIComponent(this.keyword)}&display=10&start=${this.length+1}`;try{let e=yield y.fetch(t);this.render(e)}catch(e){throw console.error(e),new Error("Fail to get naver book.")}})}render(t){var e;let{total:o,display:n,items:s}=t,r=this.length;if(this.length+=Number(n),this.updatePagingInfo({total:o,display:n}),this.pagingInfo.hidden=!1,o===0){this.showMessage("notFound");return}this.appendBookItems(s,r),o!==this.length&&((e=this.observer)===null||e===void 0||e.observe())}updatePagingInfo({total:t,display:e}){let o={keyword:`${this.keyword}`,length:`${this.length.toLocaleString()}`,total:`${t.toLocaleString()}`,display:`${e}\uAC1C\uC529`};for(let[n,s]of Object.entries(o)){let r=this.pagingInfo.querySelector(`.__${n}`);r.textContent=s}}appendBookItems(t,e){let o=new DocumentFragment;t.forEach((n,s)=>{let r=document.querySelector("[data-template=book-item]").content.firstElementChild;if(!r)return;let h=r.cloneNode(!0);h.bookData=n,h.dataset.index=(e+s).toString(),o.appendChild(h)}),this.books.appendChild(o)}showMessage(t){let e=document.querySelector(`#tp-${t}`).content.firstElementChild;if(!e)return;let o=e.cloneNode(!0);this.books.innerHTML="",this.books.appendChild(o)}};var B=class extends HTMLElement{constructor(){super(),this.render()}connectedCallback(){this.libraryButton=this.querySelector(".library-button"),this.anchorElement=this.querySelector(".book-summary"),this.render(),this.libraryButton.addEventListener("click",this.onClickLibraryButton.bind(this)),this.anchorElement.addEventListener("click",this.onClickLink.bind(this))}disconnectedCallback(){this.libraryButton.removeEventListener("click",this.onClickLibraryButton),this.anchorElement.removeEventListener("click",this.onClickLink)}render(){let{author:t,description:e,image:o,isbn:n,link:s,pubdate:r,publisher:h,title:d}=this.bookData,c=`${r.substring(0,4)}.${r.substring(4,6)}.${r.substring(6)}`,a=this.querySelector(".title");a&&(a.textContent=d);let l=this.querySelector(".publisher");l&&(l.textContent=h);let _=this.querySelector(".author");_&&(_.textContent=t);let $=this.querySelector(".pubdate");$&&($.textContent=c);let I=this.querySelector(".isbn");I&&(I.textContent=`isbn : ${n.split(" ").join(", ")}`);let M=this.querySelector("book-description");M&&(M.data=e);let T=this.querySelector(".__link");T&&(T.href=s);let O=this.querySelector("book-image");O&&(O.dataset.object=JSON.stringify({bookImageURL:o,bookname:d})),this.dataset.isbn=n}onClickLibraryButton(){let t=this.dataset.isbn||"",e=this.querySelector("library-book-exist");e&&e.onLibraryBookExist(this.libraryButton,t,b.libraries)}onClickLink(t){t.preventDefault(),location.href=`book?isbn=${this.dataset.isbn}`}};customElements.define("nav-gnb",k);customElements.define("book-list",w);customElements.define("app-search",E);customElements.define("input-search",x);customElements.define("book-item",B);customElements.define("book-description",m);customElements.define("library-book-exist",p);customElements.define("checkbox-favorite-book",v);customElements.define("book-image",g);})();
